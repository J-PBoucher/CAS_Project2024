"0","#| echo: false"
"0","#| message: FALSE"
"0","#| warning: FALSE"
"0","#| code-fold: true"
"0",""
"0","dataS <- read.csv('Data/Synthetic.csv')"
"0",""
"0","# Modifications "
"0","dataS <- dataS %>%"
"0","  mutate(Territory = as.factor(Territory)) %>%"
"0","  select(-c('Annual.pct.driven', 'Annual.miles.drive'))"
"0","data.select <- dataS"
"0",""
"0","# Train-test "
"0","set.seed(123)"
"0","train <- data.select %>% sample_frac(0.8, replace = FALSE)"
"0","test <- data.select %>% anti_join(train)"
"0",""
"0","# Modif data"
"0","train2 <- train %>%"
"0","  mutate(Miles.per.day = Total.miles.driven/Duration,"
"0","         max.day = pmax(Pct.drive.mon, Pct.drive.tue, Pct.drive.wed, Pct.drive.thr, Pct.drive.fri, Pct.drive.sat, Pct.drive.sun),"
"0","         min.day = pmin(Pct.drive.mon, Pct.drive.tue, Pct.drive.wed, Pct.drive.thr, Pct.drive.fri, Pct.drive.sat, Pct.drive.sun),"
"0","         max.min = max.day - min.day,"
"0","         Dayformax = 'Monday', "
"0","         Dayformax = ifelse(max.day == Pct.drive.tue, 'Tuesday', Dayformax),"
"0","         Dayformax = ifelse(max.day == Pct.drive.wed, 'Wednesday', Dayformax),"
"0","         Dayformax = ifelse(max.day == Pct.drive.thr, 'Thursday', Dayformax),"
"0","         Dayformax = ifelse(max.day == Pct.drive.fri, 'Friday', Dayformax),"
"0","         Dayformax = ifelse(max.day == Pct.drive.sat, 'Saturday', Dayformax),"
"0","         Dayformax = ifelse(max.day == Pct.drive.sun, 'Sunday', Dayformax),"
"0","         Dayformin = 'Monday', "
"0","         Dayformin = ifelse(min.day == Pct.drive.tue, 'Tuesday', Dayformin),"
"0","         Dayformin = ifelse(min.day == Pct.drive.wed, 'Wednesday', Dayformin),"
"0","         Dayformin = ifelse(min.day == Pct.drive.thr, 'Thursday', Dayformin),"
"0","         Dayformin = ifelse(min.day == Pct.drive.fri, 'Friday', Dayformin),"
"0","         Dayformin = ifelse(min.day == Pct.drive.sat, 'Saturday', Dayformin),"
"0","         Dayformin = ifelse(min.day == Pct.drive.sun, 'Sunday', Dayformin),"
"0","         expo = Duration/365.25)"
"0",""
"0","transform.fct <- function(var){"
"0","  df <- train2 %>% mutate(var_ = get(var)*Total.miles.driven/(1000*Duration))"
"0","  q99 <- quantile(df$var_, 0.99)"
"0","  df <- df %>% mutate(var_ = ifelse(var_ > q99, q99, var_))"
"0","  #colnames(df)[ncol(df)] <- paste0(var, '_')"
"0","  return(df)"
"0","}"
"0",""
"0","train2 <- transform.fct(""Brake.06miles"")"
"0","train2 <- transform.fct(""Brake.08miles"")"
"0","train2 <- transform.fct(""Brake.09miles"")"
"0","train2 <- transform.fct(""Brake.11miles"")"
"0","train2 <- transform.fct(""Brake.14miles"")"
"0","train2 <- transform.fct(""Accel.06miles"")"
"0","train2 <- transform.fct(""Accel.08miles"")"
"0","train2 <- transform.fct(""Accel.09miles"")"
"0","train2 <- transform.fct(""Accel.11miles"")"
"0","train2 <- transform.fct(""Accel.12miles"")"
"0","train2 <- transform.fct(""Accel.14miles"")"
"0","train2 <- transform.fct(""Left.turn.intensity08"")"
"0","train2 <- transform.fct(""Left.turn.intensity09"")"
"0","train2 <- transform.fct(""Left.turn.intensity10"")"
"0","train2 <- transform.fct(""Left.turn.intensity11"")"
"0","train2 <- transform.fct(""Left.turn.intensity12"")"
"0","train2 <- transform.fct(""Right.turn.intensity08"")"
"0","train2 <- transform.fct(""Right.turn.intensity09"")"
"0","train2 <- transform.fct(""Right.turn.intensity10"")"
"0","train2 <- transform.fct(""Right.turn.intensity11"")"
"0","train2 <- transform.fct(""Right.turn.intensity12"")"
"0",""
"0","# Create folds"
"0","nb.fold <- 5"
"0","fold <- sample(1:nb.fold, nrow(train2), replace = TRUE)"
"0","train2$fold <- fold"
"0",""
"0","##"
"0",""
"0","test2 <- test %>%"
"0","  mutate(Miles.per.day = Total.miles.driven/Duration,"
"0","         max.day = pmax(Pct.drive.mon, Pct.drive.tue, Pct.drive.wed, Pct.drive.thr, Pct.drive.fri, Pct.drive.sat, Pct.drive.sun),"
"0","         min.day = pmin(Pct.drive.mon, Pct.drive.tue, Pct.drive.wed, Pct.drive.thr, Pct.drive.fri, Pct.drive.sat, Pct.drive.sun),"
"0","         max.min = max.day - min.day,"
"0","         Dayformax = 'Monday', "
"0","         Dayformax = ifelse(max.day == Pct.drive.tue, 'Tuesday', Dayformax),"
"0","         Dayformax = ifelse(max.day == Pct.drive.wed, 'Wednesday', Dayformax),"
"0","         Dayformax = ifelse(max.day == Pct.drive.thr, 'Thursday', Dayformax),"
"0","         Dayformax = ifelse(max.day == Pct.drive.fri, 'Friday', Dayformax),"
"0","         Dayformax = ifelse(max.day == Pct.drive.sat, 'Saturday', Dayformax),"
"0","         Dayformax = ifelse(max.day == Pct.drive.sun, 'Sunday', Dayformax),"
"0","         Dayformin = 'Monday', "
"0","         Dayformin = ifelse(min.day == Pct.drive.tue, 'Tuesday', Dayformin),"
"0","         Dayformin = ifelse(min.day == Pct.drive.wed, 'Wednesday', Dayformin),"
"0","         Dayformin = ifelse(min.day == Pct.drive.thr, 'Thursday', Dayformin),"
"0","         Dayformin = ifelse(min.day == Pct.drive.fri, 'Friday', Dayformin),"
"0","         Dayformin = ifelse(min.day == Pct.drive.sat, 'Saturday', Dayformin),"
"0","         Dayformin = ifelse(min.day == Pct.drive.sun, 'Sunday', Dayformin),"
"0","         expo = Duration/365.25)"
"0",""
"0","transform.fct <- function(var){"
"0","  df <- test2 %>% mutate(var_ = get(var)*Total.miles.driven/(1000*Duration))"
"0","  q99 <- quantile(df$var_, 0.99)"
"0","  df <- df %>% mutate(var_ = ifelse(var_ > q99, q99, var_))"
"0","  #colnames(df)[ncol(df)] <- paste0(var, '_')"
"0","  return(df)"
"0","}"
"0",""
"0","test2 <- transform.fct(""Brake.06miles"")"
"0","test2 <- transform.fct(""Brake.08miles"")"
"0","test2 <- transform.fct(""Brake.09miles"")"
"0","test2 <- transform.fct(""Brake.11miles"")"
"0","test2 <- transform.fct(""Brake.14miles"")"
"0","test2 <- transform.fct(""Accel.06miles"")"
"0","test2 <- transform.fct(""Accel.08miles"")"
"0","test2 <- transform.fct(""Accel.09miles"")"
"0","test2 <- transform.fct(""Accel.11miles"")"
"0","test2 <- transform.fct(""Accel.12miles"")"
"0","test2 <- transform.fct(""Accel.14miles"")"
"0","test2 <- transform.fct(""Left.turn.intensity08"")"
"0","test2 <- transform.fct(""Left.turn.intensity09"")"
"0","test2 <- transform.fct(""Left.turn.intensity10"")"
"0","test2 <- transform.fct(""Left.turn.intensity11"")"
"0","test2 <- transform.fct(""Left.turn.intensity12"")"
"0","test2 <- transform.fct(""Right.turn.intensity08"")"
"0","test2 <- transform.fct(""Right.turn.intensity09"")"
"0","test2 <- transform.fct(""Right.turn.intensity10"")"
"0","test2 <- transform.fct(""Right.turn.intensity11"")"
"0","test2 <- transform.fct(""Right.turn.intensity12"")"
"0",""
