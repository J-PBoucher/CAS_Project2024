"0","#| echo: false"
"0","#| eval: true"
"0","#| message: FALSE"
"0","#| warning: FALSE"
"0","#| code-fold: true"
"0","#| label: fig-IA_GAM"
"0","#| fig-cap: ""Smoothing of the age of the insured"""
"0","#| fig-width: 9"
"0","#| fig-height: 4"
"0",""
"0","min_ <- min(train2$Insured.age) "
"0","max_ <- max(train2$Insured.age) "
"0","by_ <-  (max_ - min_)/(nrow(train2)-1) "
"0","add <- data.frame(seq(min_, max_, by_)) "
"0","colnames(add) <- 'Insured.age'"
"0",""
"0","db <- train2 %>%"
"0","  select(-'Insured.age') %>%"
"0","  slice(1) "
"0","db <- bind_rows(replicate(nrow(train2), db, simplify = FALSE))"
"0","db <- cbind(db, add)"
"0",""
"0","##"
"0",""
"0","score.gam <- as.formula(NB_Claim ~ Insured.sex + Marital  +  Car.use + Region + offset(log(expo))"
"0","                        + s(Insured.age) )"
"0","score.glm <- as.formula(NB_Claim ~ Insured.sex + Marital  +  Car.use + Region + offset(log(expo))"
"0","                        + Insured.age +  log(Insured.age) + I(Insured.age^2) )"
"0",""
"0","gam.fit <- gam(score.gam, family = poisson(), data = train2)"
"0","glm.fit <- glm(score.glm, family = poisson(), data = train2)"
"0",""
"0","db$pred.gam <- predict(gam.fit, newdata=db, type='response')"
"0","db$pred.glm <- predict(glm.fit, newdata=db, type='response')"
"0","base <- db %>%"
"0","  mutate(diff = abs(Insured.age - mean(train2$Insured.age))) %>%"
"0","  filter(diff == min(diff))"
"0","db$pred.gam <- db$pred.gam/base$pred.gam[1]"
"0","db$pred.glm <- db$pred.glm/base$pred.glm[1]"
"0",""
"0","ggplot()+"
"0","  geom_line(aes(x=Insured.age, y=pred.gam, color='GAM'), data=db) + "
"0","  geom_line(aes(x=Insured.age, y=pred.glm, color='Parametric GLM'), data=db) +"
"0","  guides(color = guide_legend(title = """")) +"
"0","  labs(x = 'Age of the insured',"
"0","       y = 'Relativity') +"
"0","  theme_classic()"
