<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Telematics and Algorithmic Bias - 3&nbsp; Traditional Covariates</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./VarTelematiques.html" rel="next">
<link href="./DataSummary.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="custom.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./DataSummary.html">Claim Frequency</a></li><li class="breadcrumb-item"><a href="./VarTraditionelles.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Traditional Covariates</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./images/Cars.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Telematics and Algorithmic Bias</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Theoretical concepts</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Claim Frequency</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./DataSummary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Summary</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./VarTraditionelles.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Traditional Covariates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./VarTelematiques.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Telematic Covariates</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Claim Severity</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./severity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Summary</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./severityVarTrad.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Traditional Covariates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./severityVarTelematique.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Telematic Covariates</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Discussion</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Discussion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Conclusion</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Appendix</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Proposal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Initial Proposal</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#preamble" id="toc-preamble" class="nav-link active" data-scroll-target="#preamble"><span class="header-section-number">3.1</span> Preamble</a></li>
  <li><a href="#basic-glm-models" id="toc-basic-glm-models" class="nav-link" data-scroll-target="#basic-glm-models"><span class="header-section-number">3.2</span> Basic GLM Models</a></li>
  <li><a href="#glm-net" id="toc-glm-net" class="nav-link" data-scroll-target="#glm-net"><span class="header-section-number">3.3</span> GLM-Net</a>
  <ul class="collapse">
  <li><a href="#parametric-transformation-of-continuous-covariates" id="toc-parametric-transformation-of-continuous-covariates" class="nav-link" data-scroll-target="#parametric-transformation-of-continuous-covariates"><span class="header-section-number">3.3.1</span> Parametric transformation of continuous covariates</a></li>
  <li><a href="#fitting-the-glm-net-model" id="toc-fitting-the-glm-net-model" class="nav-link" data-scroll-target="#fitting-the-glm-net-model"><span class="header-section-number">3.3.2</span> Fitting the GLM-Net model</a></li>
  </ul></li>
  <li><a href="#xgboost" id="toc-xgboost" class="nav-link" data-scroll-target="#xgboost"><span class="header-section-number">3.4</span> XGBoost</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Traditional Covariates</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="preamble" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="preamble"><span class="header-section-number">3.1</span> Preamble</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Chapter Objective</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Packages</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Data</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Using only traditional covariates, the objective of this chapter is to propose various statistical models for estimation and variable selection to predict the number of claims. More specifically, the following model families will be examined:</p>
<ul>
<li>Basic GLM,<br>
</li>
<li>GLM family, including elastic-net,<br>
</li>
<li>XGBoost.</li>
</ul>
<p>As mentioned in the theory review chapter, to compare models and strike a balance between bias and variance while avoiding overfitting, an interesting approach is to assess the prediction quality of models when applied to new data. The following R script presents a function for calculating various scores:</p>
<div class="cell" data-hash="VarTraditionelles_cache/html/unnamed-chunk-1_0d6cfc4576edce0322e90c52ab9450c1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>Score.pred <span class="ot">&lt;-</span> <span class="cf">function</span>(mu, x) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  Sc.log  <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">sum</span>(<span class="fu">dpois</span>(x, mu, <span class="at">log=</span><span class="cn">TRUE</span>))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  Sc.MSE  <span class="ot">&lt;-</span> <span class="fu">sum</span>((x <span class="sc">-</span> mu)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  Sc.quad <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">-</span><span class="dv">2</span><span class="sc">*</span><span class="fu">dpois</span>(x,<span class="at">lambda=</span>mu) <span class="sc">+</span> <span class="fu">sapply</span>(mu, <span class="cf">function</span>(x){ <span class="fu">sum</span>(<span class="fu">dpois</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>,<span class="at">lambda=</span>x)<span class="sc">^</span><span class="dv">2</span>) }))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  Sc.sph <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">-</span> <span class="fu">dpois</span>(x,mu) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">sapply</span>(mu, <span class="cf">function</span>(x){ <span class="fu">sum</span>(<span class="fu">dpois</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>,<span class="at">lambda=</span>x)<span class="sc">^</span><span class="dv">2</span>) })))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  Sc.DSS <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">dss_pois</span>(x, mu))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  Sc.CRPS <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">crps_pois</span>(x, mu))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(Sc.log, Sc.MSE, Sc.quad, Sc.sph, Sc.DSS, Sc.CRPS))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Here is the list of packages that will be used:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vtable)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(repr)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rfCountData)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gam)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scoringRules)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjPlot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>The analyses in this chapter will be conducted using the same data as in the previous chapter. However, as we concluded at the end of our overview of the data, a transformation of certain variables is also necessary.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dataS <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'Data/Synthetic.csv'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Modifications </span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>dataS <span class="ot">&lt;-</span> dataS <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Territory =</span> <span class="fu">as.factor</span>(Territory)) <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">'Annual.pct.driven'</span>, <span class="st">'Annual.miles.drive'</span>))</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>data.select <span class="ot">&lt;-</span> dataS</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Train-test </span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> data.select <span class="sc">%&gt;%</span> <span class="fu">sample_frac</span>(<span class="fl">0.8</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> data.select <span class="sc">%&gt;%</span> <span class="fu">anti_join</span>(train)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Modif data</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Miles.per.day =</span> Total.miles.driven<span class="sc">/</span>Duration,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">max.day =</span> <span class="fu">pmax</span>(Pct.drive.mon, Pct.drive.tue, Pct.drive.wed, Pct.drive.thr, Pct.drive.fri, Pct.drive.sat, Pct.drive.sun),</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">min.day =</span> <span class="fu">pmin</span>(Pct.drive.mon, Pct.drive.tue, Pct.drive.wed, Pct.drive.thr, Pct.drive.fri, Pct.drive.sat, Pct.drive.sun),</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">max.min =</span> max.day <span class="sc">-</span> min.day,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformax =</span> <span class="st">'Monday'</span>, </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformax =</span> <span class="fu">ifelse</span>(max.day <span class="sc">==</span> Pct.drive.tue, <span class="st">'Tuesday'</span>, Dayformax),</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformax =</span> <span class="fu">ifelse</span>(max.day <span class="sc">==</span> Pct.drive.wed, <span class="st">'Wednesday'</span>, Dayformax),</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformax =</span> <span class="fu">ifelse</span>(max.day <span class="sc">==</span> Pct.drive.thr, <span class="st">'Thursday'</span>, Dayformax),</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformax =</span> <span class="fu">ifelse</span>(max.day <span class="sc">==</span> Pct.drive.fri, <span class="st">'Friday'</span>, Dayformax),</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformax =</span> <span class="fu">ifelse</span>(max.day <span class="sc">==</span> Pct.drive.sat, <span class="st">'Saturday'</span>, Dayformax),</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformax =</span> <span class="fu">ifelse</span>(max.day <span class="sc">==</span> Pct.drive.sun, <span class="st">'Sunday'</span>, Dayformax),</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformin =</span> <span class="st">'Monday'</span>, </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformin =</span> <span class="fu">ifelse</span>(min.day <span class="sc">==</span> Pct.drive.tue, <span class="st">'Tuesday'</span>, Dayformin),</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformin =</span> <span class="fu">ifelse</span>(min.day <span class="sc">==</span> Pct.drive.wed, <span class="st">'Wednesday'</span>, Dayformin),</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformin =</span> <span class="fu">ifelse</span>(min.day <span class="sc">==</span> Pct.drive.thr, <span class="st">'Thursday'</span>, Dayformin),</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformin =</span> <span class="fu">ifelse</span>(min.day <span class="sc">==</span> Pct.drive.fri, <span class="st">'Friday'</span>, Dayformin),</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformin =</span> <span class="fu">ifelse</span>(min.day <span class="sc">==</span> Pct.drive.sat, <span class="st">'Saturday'</span>, Dayformin),</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformin =</span> <span class="fu">ifelse</span>(min.day <span class="sc">==</span> Pct.drive.sun, <span class="st">'Sunday'</span>, Dayformin),</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">expo =</span> Duration<span class="sc">/</span><span class="fl">365.25</span>)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>transform.fct <span class="ot">&lt;-</span> <span class="cf">function</span>(var){</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> train2 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">var_ =</span> <span class="fu">get</span>(var)<span class="sc">*</span>Total.miles.driven<span class="sc">/</span>(<span class="dv">1000</span><span class="sc">*</span>Duration))</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  q99 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(df<span class="sc">$</span>var_, <span class="fl">0.99</span>)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">var_ =</span> <span class="fu">ifelse</span>(var_ <span class="sc">&gt;</span> q99, q99, var_))</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  <span class="co">#colnames(df)[ncol(df)] &lt;- paste0(var, '_')</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Brake.06miles"</span>)</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Brake.08miles"</span>)</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Brake.09miles"</span>)</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Brake.11miles"</span>)</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Brake.14miles"</span>)</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Accel.06miles"</span>)</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Accel.08miles"</span>)</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Accel.09miles"</span>)</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Accel.11miles"</span>)</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Accel.12miles"</span>)</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Accel.14miles"</span>)</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Left.turn.intensity08"</span>)</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Left.turn.intensity09"</span>)</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Left.turn.intensity10"</span>)</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Left.turn.intensity11"</span>)</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Left.turn.intensity12"</span>)</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Right.turn.intensity08"</span>)</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Right.turn.intensity09"</span>)</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Right.turn.intensity10"</span>)</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Right.turn.intensity11"</span>)</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Right.turn.intensity12"</span>)</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Create folds</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>nb.fold <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>fold <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>nb.fold, <span class="fu">nrow</span>(train2), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>train2<span class="sc">$</span>fold <span class="ot">&lt;-</span> fold</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Miles.per.day =</span> Total.miles.driven<span class="sc">/</span>Duration,</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>         <span class="at">max.day =</span> <span class="fu">pmax</span>(Pct.drive.mon, Pct.drive.tue, Pct.drive.wed, Pct.drive.thr, Pct.drive.fri, Pct.drive.sat, Pct.drive.sun),</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>         <span class="at">min.day =</span> <span class="fu">pmin</span>(Pct.drive.mon, Pct.drive.tue, Pct.drive.wed, Pct.drive.thr, Pct.drive.fri, Pct.drive.sat, Pct.drive.sun),</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>         <span class="at">max.min =</span> max.day <span class="sc">-</span> min.day,</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformax =</span> <span class="st">'Monday'</span>, </span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformax =</span> <span class="fu">ifelse</span>(max.day <span class="sc">==</span> Pct.drive.tue, <span class="st">'Tuesday'</span>, Dayformax),</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformax =</span> <span class="fu">ifelse</span>(max.day <span class="sc">==</span> Pct.drive.wed, <span class="st">'Wednesday'</span>, Dayformax),</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformax =</span> <span class="fu">ifelse</span>(max.day <span class="sc">==</span> Pct.drive.thr, <span class="st">'Thursday'</span>, Dayformax),</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformax =</span> <span class="fu">ifelse</span>(max.day <span class="sc">==</span> Pct.drive.fri, <span class="st">'Friday'</span>, Dayformax),</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformax =</span> <span class="fu">ifelse</span>(max.day <span class="sc">==</span> Pct.drive.sat, <span class="st">'Saturday'</span>, Dayformax),</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformax =</span> <span class="fu">ifelse</span>(max.day <span class="sc">==</span> Pct.drive.sun, <span class="st">'Sunday'</span>, Dayformax),</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformin =</span> <span class="st">'Monday'</span>, </span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformin =</span> <span class="fu">ifelse</span>(min.day <span class="sc">==</span> Pct.drive.tue, <span class="st">'Tuesday'</span>, Dayformin),</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformin =</span> <span class="fu">ifelse</span>(min.day <span class="sc">==</span> Pct.drive.wed, <span class="st">'Wednesday'</span>, Dayformin),</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformin =</span> <span class="fu">ifelse</span>(min.day <span class="sc">==</span> Pct.drive.thr, <span class="st">'Thursday'</span>, Dayformin),</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformin =</span> <span class="fu">ifelse</span>(min.day <span class="sc">==</span> Pct.drive.fri, <span class="st">'Friday'</span>, Dayformin),</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformin =</span> <span class="fu">ifelse</span>(min.day <span class="sc">==</span> Pct.drive.sat, <span class="st">'Saturday'</span>, Dayformin),</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>         <span class="at">Dayformin =</span> <span class="fu">ifelse</span>(min.day <span class="sc">==</span> Pct.drive.sun, <span class="st">'Sunday'</span>, Dayformin),</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>         <span class="at">expo =</span> Duration<span class="sc">/</span><span class="fl">365.25</span>)</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>transform.fct <span class="ot">&lt;-</span> <span class="cf">function</span>(var){</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> test2 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">var_ =</span> <span class="fu">get</span>(var)<span class="sc">*</span>Total.miles.driven<span class="sc">/</span>(<span class="dv">1000</span><span class="sc">*</span>Duration))</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>  q99 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(df<span class="sc">$</span>var_, <span class="fl">0.99</span>)</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">var_ =</span> <span class="fu">ifelse</span>(var_ <span class="sc">&gt;</span> q99, q99, var_))</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>  <span class="co">#colnames(df)[ncol(df)] &lt;- paste0(var, '_')</span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Brake.06miles"</span>)</span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Brake.08miles"</span>)</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Brake.09miles"</span>)</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Brake.11miles"</span>)</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Brake.14miles"</span>)</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Accel.06miles"</span>)</span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Accel.08miles"</span>)</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Accel.09miles"</span>)</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Accel.11miles"</span>)</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Accel.12miles"</span>)</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Accel.14miles"</span>)</span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Left.turn.intensity08"</span>)</span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Left.turn.intensity09"</span>)</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Left.turn.intensity10"</span>)</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Left.turn.intensity11"</span>)</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Left.turn.intensity12"</span>)</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Right.turn.intensity08"</span>)</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Right.turn.intensity09"</span>)</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Right.turn.intensity10"</span>)</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Right.turn.intensity11"</span>)</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">transform.fct</span>(<span class="st">"Right.turn.intensity12"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="basic-glm-models" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="basic-glm-models"><span class="header-section-number">3.2</span> Basic GLM Models</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Single intercept</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Categorical covariates</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Estimated Parameters</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>A baseline model corresponding to a Generalized Linear Model (GLM) with intercept and predicting for each contract only the observed mean multiplied by the exposure is used as a point of comparison.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Model on each fold</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Result_  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>Result2_  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nb.fold) {</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    learn <span class="ot">&lt;-</span> train2[train2<span class="sc">$</span>fold <span class="sc">!=</span> i,]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    valid <span class="ot">&lt;-</span> train2[train2<span class="sc">$</span>fold <span class="sc">==</span> i,]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    mean <span class="ot">&lt;-</span> <span class="fu">sum</span>(learn<span class="sc">$</span>NB_Claim)<span class="sc">/</span><span class="fu">sum</span>(learn<span class="sc">$</span>expo) </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    learn<span class="sc">$</span>pred.base <span class="ot">&lt;-</span> mean<span class="sc">*</span>learn<span class="sc">$</span>expo</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    valid<span class="sc">$</span>pred.base <span class="ot">&lt;-</span> mean<span class="sc">*</span>valid<span class="sc">$</span>expo</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    Result_ <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result_, <span class="fu">c</span>(i, <span class="fu">Score.pred</span>(valid<span class="sc">$</span>pred.base, valid<span class="sc">$</span>NB_Claim)<span class="sc">/</span><span class="fu">nrow</span>(valid)))</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    Result2_ <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result2_, <span class="fu">c</span>(i, <span class="fu">Score.pred</span>(valid<span class="sc">$</span>pred.base, valid<span class="sc">$</span>NB_Claim)))</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Show results</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Result_) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Fold'</span>, <span class="st">"Sc.log"</span>, <span class="st">"Sc.MSE"</span>, <span class="st">"Sc.quad"</span>, <span class="st">"Sc.sph"</span>, <span class="st">"Sc.DSS"</span>, <span class="st">"Sc.CRPS"</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Result2_) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Fold'</span>, <span class="st">"Sc.log"</span>, <span class="st">"Sc.MSE"</span>, <span class="st">"Sc.quad"</span>, <span class="st">"Sc.sph"</span>, <span class="st">"Sc.DSS"</span>, <span class="st">"Sc.CRPS"</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>tot <span class="ot">&lt;-</span> <span class="fu">colSums</span>(Result2_)<span class="sc">/</span><span class="fu">nrow</span>(train2)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>tot<span class="sc">$</span>Fold <span class="ot">&lt;-</span> <span class="st">'Total'</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>Result_ <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result_ , tot)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>Result.base <span class="ot">&lt;-</span> Result_  </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>Base <span class="ot">&lt;-</span> Result.base[nb.fold<span class="sc">+</span><span class="dv">1</span>,]</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(Result_, <span class="at">align =</span> <span class="st">"ccccccc"</span>, <span class="at">digits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>), <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>))<span class="sc">%&gt;%</span>   </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">"striped"</span>, <span class="at">full_width =</span> T)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-Pscore_base" class="anchored">
<table class="table table-striped table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;3.1: Prediction scores for the base model</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Fold</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.log</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.MSE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.quad</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.sph</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.DSS</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.CRPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.18212</td>
<td style="text-align: center;">0.04666</td>
<td style="text-align: center;">-0.91794</td>
<td style="text-align: center;">-0.95797</td>
<td style="text-align: center;">-2.16359</td>
<td style="text-align: center;">0.04283</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.18185</td>
<td style="text-align: center;">0.04681</td>
<td style="text-align: center;">-0.91869</td>
<td style="text-align: center;">-0.95838</td>
<td style="text-align: center;">-2.14758</td>
<td style="text-align: center;">0.04263</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">0.17509</td>
<td style="text-align: center;">0.04555</td>
<td style="text-align: center;">-0.92361</td>
<td style="text-align: center;">-0.96096</td>
<td style="text-align: center;">-2.17549</td>
<td style="text-align: center;">0.04057</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">0.19451</td>
<td style="text-align: center;">0.05149</td>
<td style="text-align: center;">-0.91176</td>
<td style="text-align: center;">-0.95472</td>
<td style="text-align: center;">-2.06650</td>
<td style="text-align: center;">0.04650</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">0.18543</td>
<td style="text-align: center;">0.04832</td>
<td style="text-align: center;">-0.91673</td>
<td style="text-align: center;">-0.95733</td>
<td style="text-align: center;">-2.13131</td>
<td style="text-align: center;">0.04382</td>
</tr>
<tr class="even">
<td style="text-align: center;">Total</td>
<td style="text-align: center;">0.18379</td>
<td style="text-align: center;">0.04777</td>
<td style="text-align: center;">-0.91775</td>
<td style="text-align: center;">-0.95787</td>
<td style="text-align: center;">-2.13689</td>
<td style="text-align: center;">0.04327</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>The model is then estimated on the entire training set and predicted on the <em>test</em> set, which was not used in parameter calibration.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mean <span class="ot">&lt;-</span> <span class="fu">sum</span>(train2<span class="sc">$</span>NB_Claim)<span class="sc">/</span><span class="fu">sum</span>(train2<span class="sc">$</span>expo) </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>test2<span class="sc">$</span>pred.base <span class="ot">&lt;-</span> mean<span class="sc">*</span>test2<span class="sc">$</span>expo</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>Result_ <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">Score.pred</span>(test2<span class="sc">$</span>pred.base, test2<span class="sc">$</span>NB_Claim)<span class="sc">/</span><span class="fu">nrow</span>(test2)))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>Result_ <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">'Base'</span>, Result_)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Result_) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Model"</span>, <span class="st">"Sc.log"</span>, <span class="st">"Sc.MSE"</span>, <span class="st">"Sc.quad"</span>, <span class="st">"Sc.sph"</span>, <span class="st">"Sc.DSS"</span>, <span class="st">"Sc.CRPS"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>Result_all <span class="ot">&lt;-</span> Result_</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(Result_all, <span class="at">align =</span> <span class="st">"ccccccc"</span>, <span class="at">digits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>), <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>))<span class="sc">%&gt;%</span>   </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">"striped"</span>, <span class="at">full_width =</span> T)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-Pscore_basetest" class="anchored">
<table class="table table-striped table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;3.2: Prediction scores for the base model (testing set)</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.log</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.MSE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.quad</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.sph</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.DSS</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.CRPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Base</td>
<td style="text-align: center;">0.17674</td>
<td style="text-align: center;">0.04545</td>
<td style="text-align: center;">-0.92147</td>
<td style="text-align: center;">-0.95981</td>
<td style="text-align: center;">-2.19876</td>
<td style="text-align: center;">0.04127</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>A first regression approach is attempted using only the traditional categorical variables, namely:</p>
<ul>
<li>Insured’s gender,<br>
</li>
<li>Marital status,<br>
</li>
<li>Vehicle usage,<br>
</li>
<li>Region.</li>
</ul>
<p>Even though territory should also be considered since it consists of more than fifty different factors, it will not be integrated into the model immediately. As we saw in the overview of variables in a previous section, the insured’s gender did not appear to be an important variable for predicting the number of claims. This GLM approach confirms this observation. Therefore, this variable is excluded from the model. In the table below, we can see the impact of adding traditional variables on the prediction quality.</p>
<p>Below are the prediction scores of the model with all categorical covariates. As expected, the addition of segmentation variables improves the prediction scores compared to the simple baseline model with only an intercept.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Model </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>score.base <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(NB_Claim <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(expo)))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>score.glm <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(NB_Claim <span class="sc">~</span> Insured.sex <span class="sc">+</span> Marital  <span class="sc">+</span>  Car.use <span class="sc">+</span> Region <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(expo)))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Model on each fold</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>Result_  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>Result2_  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nb.fold) {</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    learn <span class="ot">&lt;-</span> train2[train2<span class="sc">$</span>fold <span class="sc">!=</span> i,]</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    valid <span class="ot">&lt;-</span> train2[train2<span class="sc">$</span>fold <span class="sc">==</span> i,]</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    glm.fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(score.glm, <span class="at">family =</span> <span class="fu">poisson</span>(), <span class="at">data =</span> learn)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    learn<span class="sc">$</span>pred.base <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm.fit, <span class="at">newdata=</span>learn, <span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    valid<span class="sc">$</span>pred.base <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm.fit, <span class="at">newdata=</span>valid, <span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    Result_ <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result_, <span class="fu">c</span>(i, <span class="fu">Score.pred</span>(valid<span class="sc">$</span>pred.base, valid<span class="sc">$</span>NB_Claim)<span class="sc">/</span><span class="fu">nrow</span>(valid)))</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    Result2_ <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result2_, <span class="fu">c</span>(i, <span class="fu">Score.pred</span>(valid<span class="sc">$</span>pred.base, valid<span class="sc">$</span>NB_Claim)))</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Model on all data from train</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>glm.base <span class="ot">&lt;-</span> <span class="fu">glm</span>(score.base, <span class="at">family =</span> <span class="fu">poisson</span>(), <span class="at">data =</span> train2)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>glm.fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(score.glm, <span class="at">family =</span> <span class="fu">poisson</span>(), <span class="at">data =</span> train2)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>train2<span class="sc">$</span>pred.glm1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm.fit, <span class="at">newdata=</span>train2, <span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>Result.glm1 <span class="ot">&lt;-</span> Result_  </span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Show results</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Result_) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Fold'</span>, <span class="st">"Sc.log"</span>, <span class="st">"Sc.MSE"</span>, <span class="st">"Sc.quad"</span>, <span class="st">"Sc.sph"</span>, <span class="st">"Sc.DSS"</span>, <span class="st">"Sc.CRPS"</span>)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Result2_) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Fold'</span>, <span class="st">"Sc.log"</span>, <span class="st">"Sc.MSE"</span>, <span class="st">"Sc.quad"</span>, <span class="st">"Sc.sph"</span>, <span class="st">"Sc.DSS"</span>, <span class="st">"Sc.CRPS"</span>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>tot <span class="ot">&lt;-</span> <span class="fu">colSums</span>(Result2_)<span class="sc">/</span><span class="fu">nrow</span>(train2)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>tot<span class="sc">$</span>Fold <span class="ot">&lt;-</span> <span class="st">'Total'</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>Result_ <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result_ , tot)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>Result_ <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result_, Base)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>Result_[nb.fold<span class="sc">+</span><span class="dv">2</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">'Improvement'</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>){</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  Result_[nb.fold<span class="sc">+</span><span class="dv">2</span>,i] <span class="ot">&lt;-</span>  Result_[nb.fold<span class="sc">+</span><span class="dv">1</span>,i] <span class="sc">-</span> Result_[nb.fold<span class="sc">+</span><span class="dv">2</span>,i]</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Result_) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(Result_, <span class="at">align =</span> <span class="st">"ccccccc"</span>, <span class="at">digits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>), <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>))<span class="sc">%&gt;%</span>   </span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">"striped"</span>, <span class="at">full_width =</span> T)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-Pscore_GLM1" class="anchored">
<table class="table table-striped table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;3.3: Prediction scores for the GLM1 model</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Fold</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.log</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.MSE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.quad</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.sph</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.DSS</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.CRPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.18098</td>
<td style="text-align: center;">0.04656</td>
<td style="text-align: center;">-0.91814</td>
<td style="text-align: center;">-0.95803</td>
<td style="text-align: center;">-2.19092</td>
<td style="text-align: center;">0.04272</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.18118</td>
<td style="text-align: center;">0.04673</td>
<td style="text-align: center;">-0.91879</td>
<td style="text-align: center;">-0.95841</td>
<td style="text-align: center;">-2.16470</td>
<td style="text-align: center;">0.04257</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">0.17414</td>
<td style="text-align: center;">0.04549</td>
<td style="text-align: center;">-0.92368</td>
<td style="text-align: center;">-0.96097</td>
<td style="text-align: center;">-2.21238</td>
<td style="text-align: center;">0.04052</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">0.19332</td>
<td style="text-align: center;">0.05137</td>
<td style="text-align: center;">-0.91193</td>
<td style="text-align: center;">-0.95477</td>
<td style="text-align: center;">-2.10039</td>
<td style="text-align: center;">0.04640</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">0.18495</td>
<td style="text-align: center;">0.04829</td>
<td style="text-align: center;">-0.91679</td>
<td style="text-align: center;">-0.95734</td>
<td style="text-align: center;">-2.15256</td>
<td style="text-align: center;">0.04379</td>
</tr>
<tr class="even">
<td style="text-align: center;">Total</td>
<td style="text-align: center;">0.18291</td>
<td style="text-align: center;">0.04769</td>
<td style="text-align: center;">-0.91787</td>
<td style="text-align: center;">-0.95791</td>
<td style="text-align: center;">-2.16420</td>
<td style="text-align: center;">0.04320</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Improvement</td>
<td style="text-align: center;">-0.00088</td>
<td style="text-align: center;">-0.00008</td>
<td style="text-align: center;">-0.00012</td>
<td style="text-align: center;">-0.00003</td>
<td style="text-align: center;">-0.02731</td>
<td style="text-align: center;">-0.00007</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>The comparison with the test dataset is also indicated in the table below. It shows that adding traditional variables does not substantially enhance prediction on the test dataset.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>score.glm <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(NB_Claim <span class="sc">~</span> Insured.sex <span class="sc">+</span> Marital  <span class="sc">+</span>  Car.use <span class="sc">+</span> Region <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(expo)))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>glm.fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(score.glm, <span class="at">family =</span> <span class="fu">poisson</span>(), <span class="at">data =</span> train2)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>test2<span class="sc">$</span>pred.base <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm.fit, <span class="at">newdata=</span>test2, <span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>Result_ <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">Score.pred</span>(test2<span class="sc">$</span>pred.base, test2<span class="sc">$</span>NB_Claim)<span class="sc">/</span><span class="fu">nrow</span>(test2)))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>Result_ <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">'GLM (trad.)'</span>, Result_)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Result_) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Model"</span>, <span class="st">"Sc.log"</span>, <span class="st">"Sc.MSE"</span>, <span class="st">"Sc.quad"</span>, <span class="st">"Sc.sph"</span>, <span class="st">"Sc.DSS"</span>, <span class="st">"Sc.CRPS"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>Result_all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result_all, Result_)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(Result_all, <span class="at">align =</span> <span class="st">"ccccccc"</span>, <span class="at">digits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>), <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>))<span class="sc">%&gt;%</span>   </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">"striped"</span>, <span class="at">full_width =</span> T)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-Pscore_basetest2" class="anchored">
<table class="table table-striped table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;3.4: Prediction scores for the GLM model with traditional covariates (testing set)</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.log</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.MSE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.quad</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.sph</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.DSS</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.CRPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Base</td>
<td style="text-align: center;">0.17674</td>
<td style="text-align: center;">0.04545</td>
<td style="text-align: center;">-0.92147</td>
<td style="text-align: center;">-0.95981</td>
<td style="text-align: center;">-2.19876</td>
<td style="text-align: center;">0.04127</td>
</tr>
<tr class="even">
<td style="text-align: center;">GLM (trad.)</td>
<td style="text-align: center;">0.17587</td>
<td style="text-align: center;">0.04538</td>
<td style="text-align: center;">-0.92157</td>
<td style="text-align: center;">-0.95984</td>
<td style="text-align: center;">-2.22852</td>
<td style="text-align: center;">0.04121</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<p>The table below shows the estimators obtained for the GLM-Poisson approach and compares them with the baseline model having only an intercept.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Model </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>score.base <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(NB_Claim <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(expo)))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>score.glm <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(NB_Claim <span class="sc">~</span> Insured.sex <span class="sc">+</span> Marital  <span class="sc">+</span>  Car.use <span class="sc">+</span> Region <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(expo)))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Model on all data from train</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>glm.base <span class="ot">&lt;-</span> <span class="fu">glm</span>(score.base, <span class="at">family =</span> <span class="fu">poisson</span>(), <span class="at">data =</span> train2)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>glm.fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(score.glm, <span class="at">family =</span> <span class="fu">poisson</span>(), <span class="at">data =</span> train2)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_model</span>(glm.base, glm.fit, <span class="at">transform =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-CoeffGLM" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;3.5: Estimated parameters for the GLM1 model</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">&nbsp;</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">NB Claim</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">NB Claim</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Predictors</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Log-Mean</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">p</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Log-Mean</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center;">p</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">(Intercept)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-2.94</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-2.98&nbsp;–&nbsp;-2.91</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-2.66</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-2.84&nbsp;–&nbsp;-2.49</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Insured sex [Male]</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.02</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.08&nbsp;–&nbsp;0.05</td>
<td style="text-align: center;">0.626</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Marital [Single]</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.12</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.05&nbsp;–&nbsp;0.19</td>
<td style="text-align: center;"><strong>0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Car use [Commute]</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.35</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.50&nbsp;–&nbsp;-0.18</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Car use [Farmer]</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-1.10</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-1.62&nbsp;–&nbsp;-0.64</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Car use [Private]</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.65</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.81&nbsp;–&nbsp;-0.48</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Region [Urban]</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.18</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.10&nbsp;–&nbsp;0.27</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">80000</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">80000</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> Nagelkerke</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.000</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.008</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
</div>
</div>
</section>
<section id="glm-net" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="glm-net"><span class="header-section-number">3.3</span> GLM-Net</h2>
<p>As we saw in the previous chapter, a series of traditional continuous segmentation variables is also available:</p>
<ul>
<li>Credit score,<br>
</li>
<li>Age of the insured,<br>
</li>
<li>Age of the vehicle,<br>
</li>
<li>Number of claim-free years,</li>
<li>Furthermore, as we will explain later, the territory will also be treated as a continuous variable.</li>
</ul>
<p>Directly using a continuous variable in a GLM is usually ineffective as it assumes a linear relationship. To avoid overfitting the data, an approach using splines, utilizing the Generalized Additive Models (GAM) theory, is interesting. This approach allows visualizing the general form of the covariate to explain the number of claims. A parametric form can then be proposed to achieve the best possible correspondence with the spline obtained by the GAM.</p>
<p>Subsequently, instead of attempting to fit a basic GLM model with all variables, we will work with a GLM-net model that allows for variable selection.</p>
<section id="parametric-transformation-of-continuous-covariates" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="parametric-transformation-of-continuous-covariates"><span class="header-section-number">3.3.1</span> Parametric transformation of continuous covariates</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Credit Score</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Age of the insured</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Age of the car</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false">Years without claims</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-5" role="tab" aria-controls="tabset-3-5" aria-selected="false">Territory</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>The first covariate studied is the credit score. We include all categorical variables in the analysis and apply a spline approach with a GAM. The spline analysis indicates that the following parametric form appears to be appropriate for capturing the relationship between the number of claims:</p>
<p><span class="math display">\[s(Credit.Score) \approx Credit.Score + Credit.Score^2\]</span></p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-CS_GAM" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="VarTraditionelles_files/figure-html/fig-CS_GAM-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption class="figure-caption">Figure&nbsp;3.1: Smoothing of the credit score</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>A spline to examine the relationship between the age of the insured and the claim frequency has also been produced. The most appropriate parametric form is as follows:</p>
<p><span class="math display">\[s(Insured.age) \approx Insured.age + \log(Insured.age) + Insured.age^2\]</span></p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-IA_GAM" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="VarTraditionelles_files/figure-html/fig-IA_GAM-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption class="figure-caption">Figure&nbsp;3.2: Smoothing of the age of the insured</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<p>The most appropriate parametric form is as follows:</p>
<p><span class="math display">\[s(Car.age) \approx Car.age + Car.age^2\]</span></p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-CA_GAM" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="VarTraditionelles_files/figure-html/fig-CA_GAM-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption class="figure-caption">Figure&nbsp;3.3: Smoothing of the age of the car</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<p>Finally, the proposed parametric form for the covariate indicating the years without claim is:</p>
<p><span class="math display">\[s(Years.noclaims) \approx Years.noclaims + Years.noclaims^2 + Years.noclaims^3\]</span></p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-YNC_GAM" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="VarTraditionelles_files/figure-html/fig-YNC_GAM-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption class="figure-caption">Figure&nbsp;3.4: Smoothing of years without claim</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-5-tab">
<p>As we saw in the previous chapter, the insured’s territory code corresponds to a categorical variable with a large cardinality. In such a situation, creating a binary variable for each possible territory is not appropriate. Instead, we propose using target encoding based on the territory’s rank.</p>
<p>This means that we first calculate the observed frequency for each territory. Then, we rank the frequencies for the 53 territories in the database. Next, the rank divided by 53 corresponds to the numerical value of the territory. This form is called rank-encoding. We believe that this transformation is justified, considering that ranking territories according to risk is an approach that could be taken in insurance companies.</p>
<p>With the encoded form of the territory, as has been done with the other continuous variables, we propose a parametric form for the spline obtained:</p>
<p><span class="math display">\[s(terr.code) \approx terr.code + terr.code^2 + terr.code^3\]</span></p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-terrcode_GAM" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="VarTraditionelles_files/figure-html/fig-terrcode_GAM-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption class="figure-caption">Figure&nbsp;3.5: Smoothing of the territories (encoded)</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="fitting-the-glm-net-model" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="fitting-the-glm-net-model"><span class="header-section-number">3.3.2</span> Fitting the GLM-Net model</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Optimal value</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Parsimonious model</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">Categorical covariates</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false">Continuous covariates</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>The parameters of the GLM-net were calibrated using cross-validation to obtain the model’s hyperparameters. Using these values, we can calculate the prediction scores of the model based on all covariates.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>glm.score <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(NB_Claim <span class="sc">~</span> Insured.sex <span class="sc">+</span> Marital  <span class="sc">+</span>  Car.use <span class="sc">+</span> Region <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(expo))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> Credit.score <span class="sc">+</span>  <span class="fu">I</span>(Credit.score<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> Insured.age <span class="sc">+</span>  <span class="fu">log</span>(Insured.age) <span class="sc">+</span> <span class="fu">I</span>(Insured.age<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> Car.age <span class="sc">+</span> <span class="fu">I</span>(Car.age<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> Years.noclaims <span class="sc">+</span> <span class="fu">I</span>(Years.noclaims<span class="sc">^</span><span class="dv">2</span>)  <span class="sc">+</span> <span class="fu">I</span>(Years.noclaims<span class="sc">^</span><span class="dv">3</span>) </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> terr.code <span class="sc">+</span> <span class="fu">I</span>(terr.code<span class="sc">^</span><span class="dv">2</span>)  <span class="sc">+</span> <span class="fu">I</span>(terr.code<span class="sc">^</span><span class="dv">3</span>) )</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>Result_  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>Result2_  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nb.fold) {</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    learn <span class="ot">&lt;-</span> train2[train2<span class="sc">$</span>fold <span class="sc">!=</span> i,]</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    valid <span class="ot">&lt;-</span> train2[train2<span class="sc">$</span>fold <span class="sc">==</span> i,]</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    matrix.x <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(glm.score, <span class="at">data=</span>learn)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> learn<span class="sc">$</span>NB_Claim</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    offset <span class="ot">&lt;-</span> <span class="fu">log</span>(learn<span class="sc">$</span>expo)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    lambda.min <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    lambda<span class="fl">.1</span>se <span class="ot">&lt;-</span> <span class="fl">0.006309573</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    lambda.select <span class="ot">&lt;-</span> lambda.min</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    fit <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(matrix.x, y, <span class="at">family =</span> <span class="st">"poisson"</span>, <span class="at">relax=</span><span class="cn">FALSE</span>, <span class="at">offset =</span> offset, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> lambda.select)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">#fit &lt;- glmnet(matrix.x, y, family = "poisson", relax=TRUE, offset = offset, alpha = 1, lambda = lambda.select)</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    matrix.x <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(glm.score, <span class="at">data=</span>valid)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> valid<span class="sc">$</span>NB_Claim</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    offset <span class="ot">&lt;-</span> <span class="fu">log</span>(valid<span class="sc">$</span>expo)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    valid<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newx =</span> matrix.x, <span class="at">type=</span><span class="st">'response'</span>, <span class="at">newoffset=</span>offset, <span class="at">lambda =</span> lambda.select)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    Result_ <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result_, <span class="fu">c</span>(i, <span class="fu">Score.pred</span>(valid<span class="sc">$</span>pred, valid<span class="sc">$</span>NB_Claim)<span class="sc">/</span><span class="fu">nrow</span>(valid)))</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    Result2_ <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result2_, <span class="fu">c</span>(i, <span class="fu">Score.pred</span>(valid<span class="sc">$</span>pred, valid<span class="sc">$</span>NB_Claim)))</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="do">## Show results</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Result_) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Fold'</span>, <span class="st">"Sc.log"</span>, <span class="st">"Sc.MSE"</span>, <span class="st">"Sc.quad"</span>, <span class="st">"Sc.sph"</span>, <span class="st">"Sc.DSS"</span>, <span class="st">"Sc.CRPS"</span>)</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Result2_) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Fold'</span>, <span class="st">"Sc.log"</span>, <span class="st">"Sc.MSE"</span>, <span class="st">"Sc.quad"</span>, <span class="st">"Sc.sph"</span>, <span class="st">"Sc.DSS"</span>, <span class="st">"Sc.CRPS"</span>)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>tot <span class="ot">&lt;-</span> <span class="fu">colSums</span>(Result2_)<span class="sc">/</span><span class="fu">nrow</span>(train2)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>tot<span class="sc">$</span>Fold <span class="ot">&lt;-</span> <span class="st">'Total'</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>Result_ <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result_ , tot)</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>Result_ <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result_, Base)</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>Result_[nb.fold<span class="sc">+</span><span class="dv">2</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">'Improvement'</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>){</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>  Result_[nb.fold<span class="sc">+</span><span class="dv">2</span>,i] <span class="ot">&lt;-</span>  Result_[nb.fold<span class="sc">+</span><span class="dv">1</span>,i] <span class="sc">-</span> Result_[nb.fold<span class="sc">+</span><span class="dv">2</span>,i]</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Result_) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(Result_, <span class="at">align =</span> <span class="st">"ccccccc"</span>, <span class="at">digits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>), <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>))<span class="sc">%&gt;%</span>   </span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">"striped"</span>, <span class="at">full_width =</span> T)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-Pscore_GLMnet1" class="anchored">
<table class="table table-striped table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;3.6: Prediction scores for the GLM-net model (alpha=1)</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Fold</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.log</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.MSE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.quad</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.sph</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.DSS</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.CRPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.17641</td>
<td style="text-align: center;">0.04602</td>
<td style="text-align: center;">-0.91898</td>
<td style="text-align: center;">-0.95827</td>
<td style="text-align: center;">-2.31270</td>
<td style="text-align: center;">0.04227</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.17750</td>
<td style="text-align: center;">0.04627</td>
<td style="text-align: center;">-0.91946</td>
<td style="text-align: center;">-0.95859</td>
<td style="text-align: center;">-2.19831</td>
<td style="text-align: center;">0.04220</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">0.16929</td>
<td style="text-align: center;">0.04499</td>
<td style="text-align: center;">-0.92431</td>
<td style="text-align: center;">-0.96113</td>
<td style="text-align: center;">-2.36647</td>
<td style="text-align: center;">0.04015</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">0.18745</td>
<td style="text-align: center;">0.05067</td>
<td style="text-align: center;">-0.91299</td>
<td style="text-align: center;">-0.95506</td>
<td style="text-align: center;">-2.23560</td>
<td style="text-align: center;">0.04582</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">0.18152</td>
<td style="text-align: center;">0.04789</td>
<td style="text-align: center;">-0.91728</td>
<td style="text-align: center;">-0.95747</td>
<td style="text-align: center;">-2.25605</td>
<td style="text-align: center;">0.04350</td>
</tr>
<tr class="even">
<td style="text-align: center;">Total</td>
<td style="text-align: center;">0.17843</td>
<td style="text-align: center;">0.04717</td>
<td style="text-align: center;">-0.91861</td>
<td style="text-align: center;">-0.95810</td>
<td style="text-align: center;">-2.27389</td>
<td style="text-align: center;">0.04278</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Improvement</td>
<td style="text-align: center;">-0.00536</td>
<td style="text-align: center;">-0.00060</td>
<td style="text-align: center;">-0.00086</td>
<td style="text-align: center;">-0.00023</td>
<td style="text-align: center;">-0.13700</td>
<td style="text-align: center;">-0.00048</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>On the test dataset, we obtain:</p>
<div class="cell" data-hash="VarTraditionelles_cache/html/tbl-Pscore_basetest3_4b2ef6b8b015410b5d293888028281a5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>glm.score <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(NB_Claim <span class="sc">~</span> Insured.sex <span class="sc">+</span> Marital  <span class="sc">+</span>  Car.use <span class="sc">+</span> Region <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(expo))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> Credit.score <span class="sc">+</span>  <span class="fu">I</span>(Credit.score<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> Insured.age <span class="sc">+</span>  <span class="fu">log</span>(Insured.age) <span class="sc">+</span> <span class="fu">I</span>(Insured.age<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> Car.age <span class="sc">+</span> <span class="fu">I</span>(Car.age<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> Years.noclaims <span class="sc">+</span> <span class="fu">I</span>(Years.noclaims<span class="sc">^</span><span class="dv">2</span>)  <span class="sc">+</span> <span class="fu">I</span>(Years.noclaims<span class="sc">^</span><span class="dv">3</span>) </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> terr.code <span class="sc">+</span> <span class="fu">I</span>(terr.code<span class="sc">^</span><span class="dv">2</span>)  <span class="sc">+</span> <span class="fu">I</span>(terr.code<span class="sc">^</span><span class="dv">3</span>) )</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>matrix.x <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(glm.score, <span class="at">data=</span>train2)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> train2<span class="sc">$</span>NB_Claim</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>offset <span class="ot">&lt;-</span> <span class="fu">log</span>(train2<span class="sc">$</span>expo)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>lambda.min <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>lambda<span class="fl">.1</span>se <span class="ot">&lt;-</span> <span class="fl">0.006309573</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>lambda.select <span class="ot">&lt;-</span> lambda.min</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(matrix.x, y, <span class="at">family =</span> <span class="st">"poisson"</span>, <span class="at">relax=</span><span class="cn">FALSE</span>, <span class="at">offset =</span> offset, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> lambda.select)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co">#fit &lt;- glmnet(matrix.x, y, family = "poisson", relax=TRUE, offset = offset, alpha = 1, lambda = lambda.select)</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>matrix.x <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(glm.score, <span class="at">data=</span>test2)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> test2<span class="sc">$</span>NB_Claim</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>offset <span class="ot">&lt;-</span> <span class="fu">log</span>(test2<span class="sc">$</span>expo)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>test2<span class="sc">$</span>pred.base <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newx =</span> matrix.x, <span class="at">type=</span><span class="st">'response'</span>, <span class="at">newoffset=</span>offset, <span class="at">lambda =</span> lambda.select)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>Result_ <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">Score.pred</span>(test2<span class="sc">$</span>pred.base, test2<span class="sc">$</span>NB_Claim)<span class="sc">/</span><span class="fu">nrow</span>(test2)))</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>Result_ <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">'LASSO (optimal)'</span>, Result_)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Result_) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Model"</span>, <span class="st">"Sc.log"</span>, <span class="st">"Sc.MSE"</span>, <span class="st">"Sc.quad"</span>, <span class="st">"Sc.sph"</span>, <span class="st">"Sc.DSS"</span>, <span class="st">"Sc.CRPS"</span>)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>Result_all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result_all, Result_)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(Result_all, <span class="at">align =</span> <span class="st">"ccccccc"</span>, <span class="at">digits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>), <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>))<span class="sc">%&gt;%</span>   </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">"striped"</span>, <span class="at">full_width =</span> T)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-Pscore_basetest3" class="anchored">
<table class="table table-striped table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;3.7: Prediction scores for the GLM-net model (testing set)</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.log</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.MSE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.quad</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.sph</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.DSS</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.CRPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Base</td>
<td style="text-align: center;">0.17674</td>
<td style="text-align: center;">0.04545</td>
<td style="text-align: center;">-0.92147</td>
<td style="text-align: center;">-0.95981</td>
<td style="text-align: center;">-2.19876</td>
<td style="text-align: center;">0.04127</td>
</tr>
<tr class="even">
<td style="text-align: center;">GLM (trad.)</td>
<td style="text-align: center;">0.17587</td>
<td style="text-align: center;">0.04538</td>
<td style="text-align: center;">-0.92157</td>
<td style="text-align: center;">-0.95984</td>
<td style="text-align: center;">-2.22852</td>
<td style="text-align: center;">0.04121</td>
</tr>
<tr class="odd">
<td style="text-align: center;">LASSO (optimal)</td>
<td style="text-align: center;">0.17169</td>
<td style="text-align: center;">0.04492</td>
<td style="text-align: center;">-0.92229</td>
<td style="text-align: center;">-0.96004</td>
<td style="text-align: center;">-2.34060</td>
<td style="text-align: center;">0.04081</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>Instead of using the optimal value of the penalty <span class="math inline">\(\lambda\)</span> in the elastic-net approach, it is often advised to use a penalty value located at one standard error (<span class="math inline">\(\lambda_{1se}\)</span>). This helps to obtain a more parsimonious model. The prediction scores of such a model are displayed below.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>Result_  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>Result2_  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nb.fold) {</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    learn <span class="ot">&lt;-</span> train2[train2<span class="sc">$</span>fold <span class="sc">!=</span> i,]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    valid <span class="ot">&lt;-</span> train2[train2<span class="sc">$</span>fold <span class="sc">==</span> i,]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    matrix.x <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(glm.score, <span class="at">data=</span>learn)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> learn<span class="sc">$</span>NB_Claim</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    offset <span class="ot">&lt;-</span> <span class="fu">log</span>(learn<span class="sc">$</span>expo)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    lambda.min <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    lambda<span class="fl">.1</span>se <span class="ot">&lt;-</span> <span class="fl">0.006309573</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    lambda.select <span class="ot">&lt;-</span> lambda<span class="fl">.1</span>se</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">#fit &lt;- glmnet(matrix.x, y, family = "poisson", relax=FALSE, offset = offset, alpha = 1, lambda = lambda.select)</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    fit <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(matrix.x, y, <span class="at">family =</span> <span class="st">"poisson"</span>, <span class="at">relax=</span><span class="cn">TRUE</span>, <span class="at">offset =</span> offset, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> lambda.select)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    matrix.x <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(glm.score, <span class="at">data=</span>valid)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> valid<span class="sc">$</span>NB_Claim</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    offset <span class="ot">&lt;-</span> <span class="fu">log</span>(valid<span class="sc">$</span>expo)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    valid<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newx =</span> matrix.x, <span class="at">type=</span><span class="st">'response'</span>, <span class="at">newoffset=</span>offset, <span class="at">lambda =</span> lambda.select)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    Result_ <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result_, <span class="fu">c</span>(i, <span class="fu">Score.pred</span>(valid<span class="sc">$</span>pred, valid<span class="sc">$</span>NB_Claim)<span class="sc">/</span><span class="fu">nrow</span>(valid)))</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    Result2_ <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result2_, <span class="fu">c</span>(i, <span class="fu">Score.pred</span>(valid<span class="sc">$</span>pred, valid<span class="sc">$</span>NB_Claim)))</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="do">## Show results</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Result_) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Fold'</span>, <span class="st">"Sc.log"</span>, <span class="st">"Sc.MSE"</span>, <span class="st">"Sc.quad"</span>, <span class="st">"Sc.sph"</span>, <span class="st">"Sc.DSS"</span>, <span class="st">"Sc.CRPS"</span>)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Result2_) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Fold'</span>, <span class="st">"Sc.log"</span>, <span class="st">"Sc.MSE"</span>, <span class="st">"Sc.quad"</span>, <span class="st">"Sc.sph"</span>, <span class="st">"Sc.DSS"</span>, <span class="st">"Sc.CRPS"</span>)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>tot <span class="ot">&lt;-</span> <span class="fu">colSums</span>(Result2_)<span class="sc">/</span><span class="fu">nrow</span>(train2)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>tot<span class="sc">$</span>Fold <span class="ot">&lt;-</span> <span class="st">'Total'</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>Result_ <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result_ , tot)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>Result_ <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result_, Base)</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>Result_[nb.fold<span class="sc">+</span><span class="dv">2</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">'Improvement'</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>){</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  Result_[nb.fold<span class="sc">+</span><span class="dv">2</span>,i] <span class="ot">&lt;-</span>  Result_[nb.fold<span class="sc">+</span><span class="dv">1</span>,i] <span class="sc">-</span> Result_[nb.fold<span class="sc">+</span><span class="dv">2</span>,i]</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Result_) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(Result_, <span class="at">align =</span> <span class="st">"ccccccc"</span>, <span class="at">digits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>), <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>))<span class="sc">%&gt;%</span>   </span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">"striped"</span>, <span class="at">full_width =</span> T)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-Pscore_GLMnet2" class="anchored">
<table class="table table-striped table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;3.8: Prediction scores for the GLM-net model (alpha=1)</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Fold</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.log</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.MSE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.quad</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.sph</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.DSS</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.CRPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.17859</td>
<td style="text-align: center;">0.04629</td>
<td style="text-align: center;">-0.91854</td>
<td style="text-align: center;">-0.95814</td>
<td style="text-align: center;">-2.25068</td>
<td style="text-align: center;">0.04251</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.17859</td>
<td style="text-align: center;">0.04646</td>
<td style="text-align: center;">-0.91924</td>
<td style="text-align: center;">-0.95853</td>
<td style="text-align: center;">-2.22599</td>
<td style="text-align: center;">0.04233</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">0.17172</td>
<td style="text-align: center;">0.04521</td>
<td style="text-align: center;">-0.92411</td>
<td style="text-align: center;">-0.96109</td>
<td style="text-align: center;">-2.26708</td>
<td style="text-align: center;">0.04029</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">0.19035</td>
<td style="text-align: center;">0.05105</td>
<td style="text-align: center;">-0.91244</td>
<td style="text-align: center;">-0.95491</td>
<td style="text-align: center;">-2.16923</td>
<td style="text-align: center;">0.04612</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">0.18272</td>
<td style="text-align: center;">0.04804</td>
<td style="text-align: center;">-0.91713</td>
<td style="text-align: center;">-0.95743</td>
<td style="text-align: center;">-2.20639</td>
<td style="text-align: center;">0.04360</td>
</tr>
<tr class="even">
<td style="text-align: center;">Total</td>
<td style="text-align: center;">0.18039</td>
<td style="text-align: center;">0.04741</td>
<td style="text-align: center;">-0.91830</td>
<td style="text-align: center;">-0.95802</td>
<td style="text-align: center;">-2.22387</td>
<td style="text-align: center;">0.04297</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Improvement</td>
<td style="text-align: center;">-0.00340</td>
<td style="text-align: center;">-0.00035</td>
<td style="text-align: center;">-0.00055</td>
<td style="text-align: center;">-0.00015</td>
<td style="text-align: center;">-0.08698</td>
<td style="text-align: center;">-0.00030</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>On the test dataset, we obtain:</p>
<div class="cell" data-hash="VarTraditionelles_cache/html/tbl-Pscore_basetest3bb_84f1a9179aae1d0449f104ea12823bbb">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>glm.score <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(NB_Claim <span class="sc">~</span> Insured.sex <span class="sc">+</span> Marital  <span class="sc">+</span>  Car.use <span class="sc">+</span> Region <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(expo))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> Credit.score <span class="sc">+</span>  <span class="fu">I</span>(Credit.score<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> Insured.age <span class="sc">+</span>  <span class="fu">log</span>(Insured.age) <span class="sc">+</span> <span class="fu">I</span>(Insured.age<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> Car.age <span class="sc">+</span> <span class="fu">I</span>(Car.age<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> Years.noclaims <span class="sc">+</span> <span class="fu">I</span>(Years.noclaims<span class="sc">^</span><span class="dv">2</span>)  <span class="sc">+</span> <span class="fu">I</span>(Years.noclaims<span class="sc">^</span><span class="dv">3</span>) </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> terr.code <span class="sc">+</span> <span class="fu">I</span>(terr.code<span class="sc">^</span><span class="dv">2</span>)  <span class="sc">+</span> <span class="fu">I</span>(terr.code<span class="sc">^</span><span class="dv">3</span>) )</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>matrix.x <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(glm.score, <span class="at">data=</span>train2)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> train2<span class="sc">$</span>NB_Claim</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>offset <span class="ot">&lt;-</span> <span class="fu">log</span>(train2<span class="sc">$</span>expo)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>lambda.min <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>lambda<span class="fl">.1</span>se <span class="ot">&lt;-</span> <span class="fl">0.006309573</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>lambda.select <span class="ot">&lt;-</span> lambda<span class="fl">.1</span>se</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co">#fit &lt;- glmnet(matrix.x, y, family = "poisson", relax=FALSE, offset = offset, alpha = 1, lambda = lambda.select)</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(matrix.x, y, <span class="at">family =</span> <span class="st">"poisson"</span>, <span class="at">relax=</span><span class="cn">TRUE</span>, <span class="at">offset =</span> offset, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> lambda.select)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>matrix.x <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(glm.score, <span class="at">data=</span>test2)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> test2<span class="sc">$</span>NB_Claim</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>offset <span class="ot">&lt;-</span> <span class="fu">log</span>(test2<span class="sc">$</span>expo)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>test2<span class="sc">$</span>pred.base <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newx =</span> matrix.x, <span class="at">type=</span><span class="st">'response'</span>, <span class="at">newoffset=</span>offset, <span class="at">lambda =</span> lambda.select)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>Result_ <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">Score.pred</span>(test2<span class="sc">$</span>pred.base, test2<span class="sc">$</span>NB_Claim)<span class="sc">/</span><span class="fu">nrow</span>(test2)))</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>Result_ <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">'LASSO (parsimonious)'</span>, Result_)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Result_) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Model"</span>, <span class="st">"Sc.log"</span>, <span class="st">"Sc.MSE"</span>, <span class="st">"Sc.quad"</span>, <span class="st">"Sc.sph"</span>, <span class="st">"Sc.DSS"</span>, <span class="st">"Sc.CRPS"</span>)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>Result_all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result_all, Result_)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(Result_all, <span class="at">align =</span> <span class="st">"ccccccc"</span>, <span class="at">digits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>), <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>))<span class="sc">%&gt;%</span>   </span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">"striped"</span>, <span class="at">full_width =</span> T)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-Pscore_basetest3bb" class="anchored">
<table class="table table-striped table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;3.9: Prediction scores for the GLM-net model (testing set)</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.log</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.MSE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.quad</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.sph</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.DSS</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.CRPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Base</td>
<td style="text-align: center;">0.17674</td>
<td style="text-align: center;">0.04545</td>
<td style="text-align: center;">-0.92147</td>
<td style="text-align: center;">-0.95981</td>
<td style="text-align: center;">-2.19876</td>
<td style="text-align: center;">0.04127</td>
</tr>
<tr class="even">
<td style="text-align: center;">GLM (trad.)</td>
<td style="text-align: center;">0.17587</td>
<td style="text-align: center;">0.04538</td>
<td style="text-align: center;">-0.92157</td>
<td style="text-align: center;">-0.95984</td>
<td style="text-align: center;">-2.22852</td>
<td style="text-align: center;">0.04121</td>
</tr>
<tr class="odd">
<td style="text-align: center;">LASSO (optimal)</td>
<td style="text-align: center;">0.17169</td>
<td style="text-align: center;">0.04492</td>
<td style="text-align: center;">-0.92229</td>
<td style="text-align: center;">-0.96004</td>
<td style="text-align: center;">-2.34060</td>
<td style="text-align: center;">0.04081</td>
</tr>
<tr class="even">
<td style="text-align: center;">LASSO (parsimonious)</td>
<td style="text-align: center;">0.17332</td>
<td style="text-align: center;">0.04511</td>
<td style="text-align: center;">-0.92202</td>
<td style="text-align: center;">-0.95997</td>
<td style="text-align: center;">-2.28596</td>
<td style="text-align: center;">0.04097</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<p>For categorical variables, the relativity values obtained for both GLM-net approaches are displayed below.</p>
<div id="fig-GLMnetcat" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-GLMnetcat-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="VarTraditionelles_files/figure-html/fig-GLMnetcat-1.png" class="img-fluid figure-img" data-ref-parent="fig-GLMnetcat" width="672"></p>
<figcaption class="figure-caption">(a) Sex of the insured</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-GLMnetcat-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="VarTraditionelles_files/figure-html/fig-GLMnetcat-2.png" class="img-fluid figure-img" data-ref-parent="fig-GLMnetcat" width="672"></p>
<figcaption class="figure-caption">(b) Marital status of the insured</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-GLMnetcat-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="VarTraditionelles_files/figure-html/fig-GLMnetcat-3.png" class="img-fluid figure-img" data-ref-parent="fig-GLMnetcat" width="672"></p>
<figcaption class="figure-caption">(c) Car use</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-GLMnetcat-4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="VarTraditionelles_files/figure-html/fig-GLMnetcat-4.png" class="img-fluid figure-img" data-ref-parent="fig-GLMnetcat" width="672"></p>
<figcaption class="figure-caption">(d) Region</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;3.6: Interpretation of the categorical variables from the GLM-net model</figcaption><p></p>
</figure>
</div>
</div>
<div id="tabset-4-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">
<p>As with categorical variables, the relativities obtained are illustrated below for continuous variables. It can be observed that the parsimonious approach tends to reduce the impact of segmentation variables on the premium.</p>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>glm.score <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(NB_Claim <span class="sc">~</span> Insured.sex <span class="sc">+</span> Marital  <span class="sc">+</span>  Car.use <span class="sc">+</span> Region <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(expo))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> Credit.score <span class="sc">+</span>  <span class="fu">I</span>(Credit.score<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> Insured.age <span class="sc">+</span>  <span class="fu">log</span>(Insured.age) <span class="sc">+</span> <span class="fu">I</span>(Insured.age<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> Car.age <span class="sc">+</span> <span class="fu">I</span>(Car.age<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> Years.noclaims <span class="sc">+</span> <span class="fu">I</span>(Years.noclaims<span class="sc">^</span><span class="dv">2</span>)  <span class="sc">+</span> <span class="fu">I</span>(Years.noclaims<span class="sc">^</span><span class="dv">3</span>) </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">+</span> terr.code <span class="sc">+</span> <span class="fu">I</span>(terr.code<span class="sc">^</span><span class="dv">2</span>)  <span class="sc">+</span> <span class="fu">I</span>(terr.code<span class="sc">^</span><span class="dv">3</span>) )</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>matrix.x <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(glm.score, <span class="at">data=</span>train2)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> train2<span class="sc">$</span>NB_Claim</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>offset <span class="ot">&lt;-</span> <span class="fu">log</span>(train2<span class="sc">$</span>expo)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>lambda.min <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>lambda<span class="fl">.1</span>se <span class="ot">&lt;-</span> <span class="fl">0.006309573</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>lasso.min <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(matrix.x, y, <span class="at">family =</span> <span class="st">"poisson"</span>, <span class="at">relax=</span><span class="cn">FALSE</span>, <span class="at">offset =</span> offset, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> lambda.min)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>lasso<span class="fl">.1</span>se <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(matrix.x, y, <span class="at">family =</span> <span class="st">"poisson"</span>, <span class="at">relax=</span><span class="cn">TRUE</span>, <span class="at">offset =</span> offset, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> lambda<span class="fl">.1</span>se)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">#cbind(coef(lasso.min), coef(lasso.1se))</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="do">### Credit Score </span><span class="al">###</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>Credit.score <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="fu">min</span>(train2<span class="sc">$</span>Credit.score), <span class="at">to=</span><span class="fu">max</span>(train2<span class="sc">$</span>Credit.score), <span class="at">by=</span><span class="dv">1</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">coef</span>(lasso<span class="fl">.1</span>se)[<span class="dv">8</span><span class="sc">:</span><span class="dv">9</span>]</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>curve1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span>Credit.score <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span>Credit.score<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>base1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>Credit.score) <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>Credit.score)<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">coef</span>(lasso.min)[<span class="dv">8</span><span class="sc">:</span><span class="dv">9</span>]</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>curve2 <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span>Credit.score <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span>Credit.score<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>base2 <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>Credit.score) <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>Credit.score)<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>curve1 <span class="ot">&lt;-</span> curve1<span class="sc">/</span>base1</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>curve2 <span class="ot">&lt;-</span> curve2<span class="sc">/</span>base2</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>db <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(Credit.score, curve1, curve2))</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Credit.score, <span class="at">y=</span>curve1, <span class="at">color =</span> <span class="st">'lambda.1se'</span> ), <span class="at">data=</span>db)<span class="sc">+</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Credit.score, <span class="at">y=</span>curve2, <span class="at">color =</span> <span class="st">'lambda.min'</span> ), <span class="at">data=</span>db)<span class="sc">+</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Credit Score'</span>,</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'Relativity'</span>) <span class="sc">+</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_classic</span>()<span class="sc">+</span>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>, <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>)</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a><span class="do">### Insured.age </span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>Insured.age <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="fu">min</span>(train2<span class="sc">$</span>Insured.age ), <span class="at">to=</span><span class="fu">max</span>(train2<span class="sc">$</span>Insured.age ), <span class="at">by=</span><span class="dv">1</span>)</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">coef</span>(lasso<span class="fl">.1</span>se)[<span class="dv">10</span><span class="sc">:</span><span class="dv">12</span>]</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>curve1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span>Insured.age  <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span><span class="fu">log</span>(Insured.age ) <span class="sc">+</span> beta[<span class="dv">3</span>]<span class="sc">*</span>Insured.age<span class="sc">^</span><span class="dv">2</span>)       </span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>base1  <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>Insured.age) <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span><span class="fu">log</span>(<span class="fu">mean</span>(train2<span class="sc">$</span>Insured.age)) <span class="sc">+</span> beta[<span class="dv">3</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>Insured.age)<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">coef</span>(lasso.min)[<span class="dv">10</span><span class="sc">:</span><span class="dv">12</span>]</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>curve2 <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span>Insured.age  <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span><span class="fu">log</span>(Insured.age ) <span class="sc">+</span> beta[<span class="dv">3</span>]<span class="sc">*</span>Insured.age<span class="sc">^</span><span class="dv">2</span>)       </span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>base2  <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>Insured.age) <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span><span class="fu">log</span>(<span class="fu">mean</span>(train2<span class="sc">$</span>Insured.age)) <span class="sc">+</span> beta[<span class="dv">3</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>Insured.age)<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>curve1 <span class="ot">&lt;-</span> curve1<span class="sc">/</span>base1</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>curve2 <span class="ot">&lt;-</span> curve2<span class="sc">/</span>base2</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>db <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(Insured.age, curve1, curve2))</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Insured.age, <span class="at">y=</span>curve1, <span class="at">color =</span> <span class="st">'lambda.1se'</span> ), <span class="at">data=</span>db)<span class="sc">+</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Insured.age, <span class="at">y=</span>curve2, <span class="at">color =</span> <span class="st">'lambda.min'</span> ), <span class="at">data=</span>db)<span class="sc">+</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Age of the insured'</span>,</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'Relativity'</span>) <span class="sc">+</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_classic</span>()<span class="sc">+</span>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>, <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>)</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a><span class="do">### Car Age </span><span class="al">###</span></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>Car.age <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="fu">min</span>(train2<span class="sc">$</span>Car.age), <span class="at">to=</span><span class="fu">max</span>(train2<span class="sc">$</span>Car.age), <span class="at">by=</span><span class="dv">1</span>)</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">coef</span>(lasso<span class="fl">.1</span>se)[<span class="dv">13</span><span class="sc">:</span><span class="dv">14</span>]</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>curve1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span>Car.age <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span>Car.age<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>base1  <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>Car.age) <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>Car.age)<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">coef</span>(lasso.min)[<span class="dv">13</span><span class="sc">:</span><span class="dv">14</span>]</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>curve2 <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span>Car.age <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span>Car.age<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>base2  <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>Car.age) <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>Car.age)<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>curve1 <span class="ot">&lt;-</span> curve1<span class="sc">/</span>base1</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>curve2 <span class="ot">&lt;-</span> curve2<span class="sc">/</span>base2</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>db <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(Car.age, curve1, curve2))</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Car.age, <span class="at">y=</span>curve1, <span class="at">color =</span> <span class="st">'lambda.1se'</span> ), <span class="at">data=</span>db)<span class="sc">+</span></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Car.age, <span class="at">y=</span>curve2, <span class="at">color =</span> <span class="st">'lambda.min'</span> ), <span class="at">data=</span>db)<span class="sc">+</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Age of the car'</span>,</span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'Relativity'</span>) <span class="sc">+</span></span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_classic</span>()<span class="sc">+</span>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>, <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>)</span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a><span class="do">### Years.noclaims </span></span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>Years.noclaims <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="fu">min</span>(train2<span class="sc">$</span>Years.noclaims ), <span class="at">to=</span><span class="fu">max</span>(train2<span class="sc">$</span>Years.noclaims ), <span class="at">by=</span><span class="dv">1</span>)</span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">coef</span>(lasso<span class="fl">.1</span>se)[<span class="dv">15</span><span class="sc">:</span><span class="dv">17</span>]</span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>curve1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span>Years.noclaims  <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span>Years.noclaims<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> beta[<span class="dv">3</span>]<span class="sc">*</span>Years.noclaims <span class="sc">^</span><span class="dv">3</span>)        </span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>base1  <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>Years.noclaims) <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>Years.noclaims)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> beta[<span class="dv">3</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>Years.noclaims)<span class="sc">^</span><span class="dv">3</span>) </span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">coef</span>(lasso.min)[<span class="dv">15</span><span class="sc">:</span><span class="dv">17</span>]</span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>curve2 <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span>Years.noclaims  <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span>Years.noclaims<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> beta[<span class="dv">3</span>]<span class="sc">*</span>Years.noclaims <span class="sc">^</span><span class="dv">3</span>)        </span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>base2  <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>Years.noclaims) <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>Years.noclaims)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> beta[<span class="dv">3</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>Years.noclaims)<span class="sc">^</span><span class="dv">3</span>) </span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>curve1 <span class="ot">&lt;-</span> curve1<span class="sc">/</span>base1</span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>curve2 <span class="ot">&lt;-</span> curve2<span class="sc">/</span>base2</span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>db <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(Years.noclaims, curve1, curve2))</span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Years.noclaims, <span class="at">y=</span>curve1, <span class="at">color =</span> <span class="st">'lambda.1se'</span> ), <span class="at">data=</span>db)<span class="sc">+</span></span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Years.noclaims, <span class="at">y=</span>curve2, <span class="at">color =</span> <span class="st">'lambda.min'</span> ), <span class="at">data=</span>db)<span class="sc">+</span></span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Years without claim'</span>,</span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'Relativity'</span>) <span class="sc">+</span></span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_classic</span>()<span class="sc">+</span>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>, <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>)</span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a><span class="do">### terr.code  </span></span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a>terr.code  <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="fu">min</span>(train2<span class="sc">$</span>terr.code  ), <span class="at">to=</span><span class="fu">max</span>(train2<span class="sc">$</span>terr.code  ), <span class="at">by=</span><span class="fl">0.01</span>)</span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">coef</span>(lasso<span class="fl">.1</span>se)[<span class="dv">18</span><span class="sc">:</span><span class="dv">20</span>]</span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>curve1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span>terr.code <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span>terr.code<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> beta[<span class="dv">3</span>]<span class="sc">*</span>terr.code<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>base1  <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>terr.code) <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>terr.code)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> beta[<span class="dv">3</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>terr.code)<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">coef</span>(lasso.min)[<span class="dv">18</span><span class="sc">:</span><span class="dv">20</span>]</span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a>curve2 <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span>terr.code <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span>terr.code<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> beta[<span class="dv">3</span>]<span class="sc">*</span>terr.code<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb13-116"><a href="#cb13-116" aria-hidden="true" tabindex="-1"></a>base2  <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>terr.code) <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>terr.code)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> beta[<span class="dv">3</span>]<span class="sc">*</span><span class="fu">mean</span>(train2<span class="sc">$</span>terr.code)<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb13-117"><a href="#cb13-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-118"><a href="#cb13-118" aria-hidden="true" tabindex="-1"></a>curve1 <span class="ot">&lt;-</span> curve1<span class="sc">/</span>base1</span>
<span id="cb13-119"><a href="#cb13-119" aria-hidden="true" tabindex="-1"></a>curve2 <span class="ot">&lt;-</span> curve2<span class="sc">/</span>base2</span>
<span id="cb13-120"><a href="#cb13-120" aria-hidden="true" tabindex="-1"></a>db <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(terr.code, curve1, curve2))</span>
<span id="cb13-121"><a href="#cb13-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-122"><a href="#cb13-122" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb13-123"><a href="#cb13-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>terr.code, <span class="at">y=</span>curve1, <span class="at">color =</span> <span class="st">'lambda.1se'</span> ), <span class="at">data=</span>db)<span class="sc">+</span></span>
<span id="cb13-124"><a href="#cb13-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>terr.code, <span class="at">y=</span>curve2, <span class="at">color =</span> <span class="st">'lambda.min'</span> ), <span class="at">data=</span>db)<span class="sc">+</span></span>
<span id="cb13-125"><a href="#cb13-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb13-126"><a href="#cb13-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Territory (encoded)'</span>,</span>
<span id="cb13-127"><a href="#cb13-127" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'Relativity'</span>) <span class="sc">+</span></span>
<span id="cb13-128"><a href="#cb13-128" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_classic</span>()<span class="sc">+</span>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>, <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-GLMnet" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-GLMnet-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="VarTraditionelles_files/figure-html/fig-GLMnet-1.png" class="img-fluid figure-img" data-ref-parent="fig-GLMnet" width="672"></p>
<figcaption class="figure-caption">(a) Credit Score</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-GLMnet-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="VarTraditionelles_files/figure-html/fig-GLMnet-2.png" class="img-fluid figure-img" data-ref-parent="fig-GLMnet" width="672"></p>
<figcaption class="figure-caption">(b) Age of the insured</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-GLMnet-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="VarTraditionelles_files/figure-html/fig-GLMnet-3.png" class="img-fluid figure-img" data-ref-parent="fig-GLMnet" width="672"></p>
<figcaption class="figure-caption">(c) Age of the car</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-GLMnet-4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="VarTraditionelles_files/figure-html/fig-GLMnet-4.png" class="img-fluid figure-img" data-ref-parent="fig-GLMnet" width="672"></p>
<figcaption class="figure-caption">(d) Years without claim</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-GLMnet-5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="VarTraditionelles_files/figure-html/fig-GLMnet-5.png" class="img-fluid figure-img" data-ref-parent="fig-GLMnet" width="672"></p>
<figcaption class="figure-caption">(e) Territory Code</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;3.7: Interpretation of the continuous variables from the GLM-net model:</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="xgboost" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="xgboost"><span class="header-section-number">3.4</span> XGBoost</h2>
<p>Another approach to consider is XGBoost. However, through cross-validation, this method requires finely tuning its hyperparameters to be effective. We utilized a grid search approach coupled with Bayesian optimization for the dataset used in the project.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Prediction Scores</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Variables Importance</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<p>With the hyperparameters we discovered, we can compute the model’s prediction scores. The scores obtained show a significant improvement compared to other tested approaches.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Ckmeans<span class="fl">.1</span>d.dp)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SHAPforxgboost)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>trad.vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Marital"</span>, <span class="st">"Car.use"</span>, <span class="st">"Region"</span>, <span class="st">"Insured.sex"</span>, <span class="st">"Credit.score"</span>, <span class="st">"Insured.age"</span>, <span class="st">"Car.age"</span>, <span class="st">"Years.noclaims"</span>, <span class="st">"Territory"</span>) </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>dtrain <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> <span class="fu">data.matrix</span>(train2[, <span class="fu">paste</span>(trad.vars)]), <span class="at">label =</span> train2<span class="sc">$</span>NB_Claim)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">setinfo</span>(dtrain,<span class="st">"base_margin"</span>,<span class="fu">log</span>(train2<span class="sc">$</span>expo))</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">fold1 =</span> <span class="fu">which</span>(train2<span class="sc">$</span>fold <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">fold2 =</span> <span class="fu">which</span>(train2<span class="sc">$</span>fold <span class="sc">==</span> <span class="dv">2</span>),</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">fold3 =</span> <span class="fu">which</span>(train2<span class="sc">$</span>fold <span class="sc">==</span> <span class="dv">3</span>),</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">fold4 =</span> <span class="fu">which</span>(train2<span class="sc">$</span>fold <span class="sc">==</span> <span class="dv">4</span>),</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">fold5 =</span> <span class="fu">which</span>(train2<span class="sc">$</span>fold <span class="sc">==</span> <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="VarTraditionelles_cache/html/tbl-Pscore_XGBoost_bc12b84ebdc7159412c0cc026ed40dee">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.08846194</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">43</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="fl">0.8389601</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_child_weight =</span> <span class="dv">1</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">booster =</span> <span class="st">"gbtree"</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">"count:poisson"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">eval_metric =</span> <span class="st">"poisson-nloglik"</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">333</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>xgbcv <span class="ot">&lt;-</span> <span class="fu">xgb.cv</span>(<span class="at">params =</span> param,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">nrounds =</span> <span class="dv">96</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> dtrain,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">folds =</span> folds,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">prediction =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">early_stopping_rounds =</span> <span class="dv">10</span>,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">verbose =</span> <span class="dv">0</span>,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">maximize =</span> F)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>Sc.log <span class="ot">&lt;-</span> <span class="fu">sapply</span>(xgbcv<span class="sc">$</span>folds, <span class="cf">function</span>(x){<span class="sc">-</span><span class="fu">dpois</span>(train2<span class="sc">$</span>NB_Claim[x], <span class="fu">unlist</span>(xgbcv<span class="sc">$</span>pred[x]), <span class="at">log=</span><span class="cn">TRUE</span>)})</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>Sc.MSE <span class="ot">&lt;-</span> <span class="fu">sapply</span>(xgbcv<span class="sc">$</span>folds, <span class="cf">function</span>(x){(train2<span class="sc">$</span>NB_Claim[x]<span class="sc">-</span><span class="fu">unlist</span>(xgbcv<span class="sc">$</span>pred[x]))<span class="sc">^</span><span class="dv">2</span>})</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>Sc.quad <span class="ot">&lt;-</span> <span class="fu">sapply</span>(xgbcv<span class="sc">$</span>folds, <span class="cf">function</span>(x){</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  nb <span class="ot">&lt;-</span> train2<span class="sc">$</span>NB_Claim[x]</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fu">unlist</span>(xgbcv<span class="sc">$</span>pred[x])</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span><span class="fu">dpois</span>(nb,<span class="at">lambda=</span>mu) <span class="sc">+</span> <span class="fu">dpois</span>(<span class="dv">0</span>,<span class="at">lambda=</span>mu)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">dpois</span>(<span class="dv">1</span>,<span class="at">lambda=</span>mu)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">dpois</span>(<span class="dv">2</span>,<span class="at">lambda=</span>mu)<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span> <span class="fu">dpois</span>(<span class="dv">3</span>,<span class="at">lambda=</span>mu)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">dpois</span>(<span class="dv">4</span>,<span class="at">lambda=</span>mu)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">dpois</span>(<span class="dv">5</span>,<span class="at">lambda=</span>mu)<span class="sc">^</span><span class="dv">2</span> </span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>})  </span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>Sc.sph <span class="ot">&lt;-</span> <span class="fu">sapply</span>(xgbcv<span class="sc">$</span>folds, <span class="cf">function</span>(x){</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  nb <span class="ot">&lt;-</span> train2<span class="sc">$</span>NB_Claim[x]</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fu">unlist</span>(xgbcv<span class="sc">$</span>pred[x])</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fu">dpois</span>(nb,<span class="at">lambda=</span>mu) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">dpois</span>(<span class="dv">0</span>,<span class="at">lambda=</span>mu)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">dpois</span>(<span class="dv">1</span>,<span class="at">lambda=</span>mu)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">dpois</span>(<span class="dv">2</span>,<span class="at">lambda=</span>mu)<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span> <span class="fu">dpois</span>(<span class="dv">3</span>,<span class="at">lambda=</span>mu)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">dpois</span>(<span class="dv">4</span>,<span class="at">lambda=</span>mu)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">dpois</span>(<span class="dv">5</span>,<span class="at">lambda=</span>mu)<span class="sc">^</span><span class="dv">2</span> ) </span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>Sc.DSS <span class="ot">&lt;-</span> <span class="fu">sapply</span>(xgbcv<span class="sc">$</span>folds, <span class="cf">function</span>(x){<span class="fu">dss_pois</span>(train2<span class="sc">$</span>NB_Claim[x], <span class="fu">unlist</span>(xgbcv<span class="sc">$</span>pred[x]))})</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>Sc.CRPS <span class="ot">&lt;-</span> <span class="fu">sapply</span>(xgbcv<span class="sc">$</span>folds, <span class="cf">function</span>(x){<span class="fu">crps_pois</span>(train2<span class="sc">$</span>NB_Claim[x], <span class="fu">unlist</span>(xgbcv<span class="sc">$</span>pred[x]))})</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>Result_  <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">mean</span>(Sc.log[<span class="dv">1</span>]<span class="sc">$</span>fold1), <span class="fu">mean</span>(Sc.MSE[<span class="dv">1</span>]<span class="sc">$</span>fold1), <span class="fu">mean</span>(Sc.quad[<span class="dv">1</span>]<span class="sc">$</span>fold1), <span class="fu">mean</span>(Sc.sph[<span class="dv">1</span>]<span class="sc">$</span>fold1), <span class="fu">mean</span>(Sc.DSS[<span class="dv">1</span>]<span class="sc">$</span>fold1), <span class="fu">mean</span>(Sc.CRPS[<span class="dv">1</span>]<span class="sc">$</span>fold1)),</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">2</span>,<span class="fu">mean</span>(Sc.log[<span class="dv">2</span>]<span class="sc">$</span>fold2), <span class="fu">mean</span>(Sc.MSE[<span class="dv">2</span>]<span class="sc">$</span>fold2), <span class="fu">mean</span>(Sc.quad[<span class="dv">2</span>]<span class="sc">$</span>fold2), <span class="fu">mean</span>(Sc.sph[<span class="dv">2</span>]<span class="sc">$</span>fold2), <span class="fu">mean</span>(Sc.DSS[<span class="dv">2</span>]<span class="sc">$</span>fold2), <span class="fu">mean</span>(Sc.CRPS[<span class="dv">2</span>]<span class="sc">$</span>fold2)),</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">3</span>,<span class="fu">mean</span>(Sc.log[<span class="dv">3</span>]<span class="sc">$</span>fold3), <span class="fu">mean</span>(Sc.MSE[<span class="dv">3</span>]<span class="sc">$</span>fold3), <span class="fu">mean</span>(Sc.quad[<span class="dv">3</span>]<span class="sc">$</span>fold3), <span class="fu">mean</span>(Sc.sph[<span class="dv">3</span>]<span class="sc">$</span>fold3), <span class="fu">mean</span>(Sc.DSS[<span class="dv">3</span>]<span class="sc">$</span>fold3), <span class="fu">mean</span>(Sc.CRPS[<span class="dv">3</span>]<span class="sc">$</span>fold3)),</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">4</span>,<span class="fu">mean</span>(Sc.log[<span class="dv">4</span>]<span class="sc">$</span>fold4), <span class="fu">mean</span>(Sc.MSE[<span class="dv">4</span>]<span class="sc">$</span>fold4), <span class="fu">mean</span>(Sc.quad[<span class="dv">4</span>]<span class="sc">$</span>fold4), <span class="fu">mean</span>(Sc.sph[<span class="dv">4</span>]<span class="sc">$</span>fold4), <span class="fu">mean</span>(Sc.DSS[<span class="dv">4</span>]<span class="sc">$</span>fold4), <span class="fu">mean</span>(Sc.CRPS[<span class="dv">4</span>]<span class="sc">$</span>fold4)),</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">5</span>,<span class="fu">mean</span>(Sc.log[<span class="dv">5</span>]<span class="sc">$</span>fold5), <span class="fu">mean</span>(Sc.MSE[<span class="dv">5</span>]<span class="sc">$</span>fold5), <span class="fu">mean</span>(Sc.quad[<span class="dv">5</span>]<span class="sc">$</span>fold5), <span class="fu">mean</span>(Sc.sph[<span class="dv">5</span>]<span class="sc">$</span>fold5), <span class="fu">mean</span>(Sc.DSS[<span class="dv">5</span>]<span class="sc">$</span>fold5), <span class="fu">mean</span>(Sc.CRPS[<span class="dv">5</span>]<span class="sc">$</span>fold5))</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>Res.sum  <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">sum</span>(Sc.log[<span class="dv">1</span>]<span class="sc">$</span>fold1), <span class="fu">sum</span>(Sc.MSE[<span class="dv">1</span>]<span class="sc">$</span>fold1), <span class="fu">sum</span>(Sc.quad[<span class="dv">1</span>]<span class="sc">$</span>fold1), <span class="fu">sum</span>(Sc.sph[<span class="dv">1</span>]<span class="sc">$</span>fold1), <span class="fu">sum</span>(Sc.DSS[<span class="dv">1</span>]<span class="sc">$</span>fold1), <span class="fu">sum</span>(Sc.CRPS[<span class="dv">1</span>]<span class="sc">$</span>fold1)),</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">sum</span>(Sc.log[<span class="dv">2</span>]<span class="sc">$</span>fold2), <span class="fu">sum</span>(Sc.MSE[<span class="dv">2</span>]<span class="sc">$</span>fold2), <span class="fu">sum</span>(Sc.quad[<span class="dv">2</span>]<span class="sc">$</span>fold2), <span class="fu">sum</span>(Sc.sph[<span class="dv">2</span>]<span class="sc">$</span>fold2), <span class="fu">sum</span>(Sc.DSS[<span class="dv">2</span>]<span class="sc">$</span>fold2), <span class="fu">sum</span>(Sc.CRPS[<span class="dv">2</span>]<span class="sc">$</span>fold2)),</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">sum</span>(Sc.log[<span class="dv">3</span>]<span class="sc">$</span>fold3), <span class="fu">sum</span>(Sc.MSE[<span class="dv">3</span>]<span class="sc">$</span>fold3), <span class="fu">sum</span>(Sc.quad[<span class="dv">3</span>]<span class="sc">$</span>fold3), <span class="fu">sum</span>(Sc.sph[<span class="dv">3</span>]<span class="sc">$</span>fold3), <span class="fu">sum</span>(Sc.DSS[<span class="dv">3</span>]<span class="sc">$</span>fold3), <span class="fu">sum</span>(Sc.CRPS[<span class="dv">3</span>]<span class="sc">$</span>fold3)),</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">sum</span>(Sc.log[<span class="dv">4</span>]<span class="sc">$</span>fold4), <span class="fu">sum</span>(Sc.MSE[<span class="dv">4</span>]<span class="sc">$</span>fold4), <span class="fu">sum</span>(Sc.quad[<span class="dv">4</span>]<span class="sc">$</span>fold4), <span class="fu">sum</span>(Sc.sph[<span class="dv">4</span>]<span class="sc">$</span>fold4), <span class="fu">sum</span>(Sc.DSS[<span class="dv">4</span>]<span class="sc">$</span>fold4), <span class="fu">sum</span>(Sc.CRPS[<span class="dv">4</span>]<span class="sc">$</span>fold4)),</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">sum</span>(Sc.log[<span class="dv">5</span>]<span class="sc">$</span>fold5), <span class="fu">sum</span>(Sc.MSE[<span class="dv">5</span>]<span class="sc">$</span>fold5), <span class="fu">sum</span>(Sc.quad[<span class="dv">5</span>]<span class="sc">$</span>fold5), <span class="fu">sum</span>(Sc.sph[<span class="dv">5</span>]<span class="sc">$</span>fold5), <span class="fu">sum</span>(Sc.DSS[<span class="dv">5</span>]<span class="sc">$</span>fold5), <span class="fu">sum</span>(Sc.CRPS[<span class="dv">5</span>]<span class="sc">$</span>fold5))</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>sum <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Total'</span>, <span class="fu">colSums</span>(Res.sum)<span class="sc">/</span><span class="fu">nrow</span>(train2))</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>Result_  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">rbind</span>(Result_, sum)) </span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a><span class="do">## Show results</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Result_) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Fold'</span>, <span class="st">"Sc.log"</span>, <span class="st">"Sc.MSE"</span>, <span class="st">"Sc.quad"</span>, <span class="st">"Sc.sph"</span>, <span class="st">"Sc.DSS"</span>, <span class="st">"Sc.CRPS"</span>)</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>Result_ <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result_, Base)</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>Result_[nb.fold<span class="sc">+</span><span class="dv">2</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">'Improvement'</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>){</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>  Result_[,i] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(Result_[,i])  </span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>  Result_[nb.fold<span class="sc">+</span><span class="dv">2</span>,i] <span class="ot">&lt;-</span>  Result_[nb.fold<span class="sc">+</span><span class="dv">1</span>,i] <span class="sc">-</span> Result_[nb.fold<span class="sc">+</span><span class="dv">2</span>,i]</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Result_) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(Result_, <span class="at">align =</span> <span class="st">"ccccccc"</span>, <span class="at">digits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>), <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>))<span class="sc">%&gt;%</span>   </span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">"striped"</span>, <span class="at">full_width =</span> T)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-Pscore_XGBoost" class="anchored">
<table class="table table-striped table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;3.10: Prediction scores for the XGBoost model</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Fold</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.log</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.MSE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.quad</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.sph</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.DSS</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.CRPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.15641</td>
<td style="text-align: center;">0.04057</td>
<td style="text-align: center;">-0.92589</td>
<td style="text-align: center;">-0.96093</td>
<td style="text-align: center;">-2.62584</td>
<td style="text-align: center;">0.03824</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.15288</td>
<td style="text-align: center;">0.03912</td>
<td style="text-align: center;">-0.92772</td>
<td style="text-align: center;">-0.96181</td>
<td style="text-align: center;">-2.65957</td>
<td style="text-align: center;">0.03720</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">0.14901</td>
<td style="text-align: center;">0.03948</td>
<td style="text-align: center;">-0.93151</td>
<td style="text-align: center;">-0.96388</td>
<td style="text-align: center;">-2.64415</td>
<td style="text-align: center;">0.03599</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">0.16611</td>
<td style="text-align: center;">0.04377</td>
<td style="text-align: center;">-0.92036</td>
<td style="text-align: center;">-0.95790</td>
<td style="text-align: center;">-2.55143</td>
<td style="text-align: center;">0.04115</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">0.16121</td>
<td style="text-align: center;">0.04232</td>
<td style="text-align: center;">-0.92452</td>
<td style="text-align: center;">-0.96026</td>
<td style="text-align: center;">-2.54601</td>
<td style="text-align: center;">0.03928</td>
</tr>
<tr class="even">
<td style="text-align: center;">Total</td>
<td style="text-align: center;">0.15712</td>
<td style="text-align: center;">0.04105</td>
<td style="text-align: center;">-0.92600</td>
<td style="text-align: center;">-0.96096</td>
<td style="text-align: center;">-2.60534</td>
<td style="text-align: center;">0.03837</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Improvement</td>
<td style="text-align: center;">-0.02667</td>
<td style="text-align: center;">-0.00671</td>
<td style="text-align: center;">-0.00825</td>
<td style="text-align: center;">-0.00308</td>
<td style="text-align: center;">-0.46845</td>
<td style="text-align: center;">-0.00490</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>We can use the same model to compute scores on the <em>test</em> set. Furthermore, it’s evident that the XGBoost approach is the most effective.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>dtrain <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> <span class="fu">data.matrix</span>(train2[, <span class="fu">paste</span>(trad.vars)]), <span class="at">label =</span> train2<span class="sc">$</span>NB_Claim)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setinfo</span>(dtrain,<span class="st">"base_margin"</span>,<span class="fu">log</span>(train2<span class="sc">$</span>expo))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">fold1 =</span> <span class="fu">which</span>(train2<span class="sc">$</span>fold <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">fold2 =</span> <span class="fu">which</span>(train2<span class="sc">$</span>fold <span class="sc">==</span> <span class="dv">2</span>),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">fold3 =</span> <span class="fu">which</span>(train2<span class="sc">$</span>fold <span class="sc">==</span> <span class="dv">3</span>),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">fold4 =</span> <span class="fu">which</span>(train2<span class="sc">$</span>fold <span class="sc">==</span> <span class="dv">4</span>),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">fold5 =</span> <span class="fu">which</span>(train2<span class="sc">$</span>fold <span class="sc">==</span> <span class="dv">5</span>))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>dtest <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> <span class="fu">data.matrix</span>(test2[, <span class="fu">paste</span>(trad.vars)]), <span class="at">label =</span> test2<span class="sc">$</span>NB_Claim)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">setinfo</span>(dtest,<span class="st">"base_margin"</span>,<span class="fu">log</span>(test2<span class="sc">$</span>expo))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.08846194</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">43</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="fl">0.8389601</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_child_weight =</span> <span class="dv">1</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">booster =</span> <span class="st">"gbtree"</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">"count:poisson"</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">eval_metric =</span> <span class="st">"poisson-nloglik"</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">333</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>fit.xgb <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(<span class="at">params =</span> param,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">nrounds =</span> <span class="dv">96</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> dtrain)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>train2<span class="sc">$</span>pred.xgb <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.xgb, dtrain, <span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>test2<span class="sc">$</span>pred.xgb <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.xgb, dtest, <span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>test2<span class="sc">$</span>pred.base <span class="ot">&lt;-</span> test2<span class="sc">$</span>pred.xgb</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>Result_ <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">Score.pred</span>(test2<span class="sc">$</span>pred.base, test2<span class="sc">$</span>NB_Claim)<span class="sc">/</span><span class="fu">nrow</span>(test2)))</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>Result_ <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">'XGBoost'</span>, Result_)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Result_) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Model"</span>, <span class="st">"Sc.log"</span>, <span class="st">"Sc.MSE"</span>, <span class="st">"Sc.quad"</span>, <span class="st">"Sc.sph"</span>, <span class="st">"Sc.DSS"</span>, <span class="st">"Sc.CRPS"</span>)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>Result_all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Result_all, Result_)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(Result_all, <span class="at">align =</span> <span class="st">"ccccccc"</span>, <span class="at">digits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>), <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>))<span class="sc">%&gt;%</span>   </span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">"striped"</span>, <span class="at">full_width =</span> T)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-Pscore_XGBoost_correction333" class="anchored">
<table class="table table-striped table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;3.11: Prediction scores for the XGBoost model with traditional covariates</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.log</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.MSE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.quad</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.sph</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.DSS</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Sc.CRPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Base</td>
<td style="text-align: center;">0.17674</td>
<td style="text-align: center;">0.04545</td>
<td style="text-align: center;">-0.92147</td>
<td style="text-align: center;">-0.95981</td>
<td style="text-align: center;">-2.19876</td>
<td style="text-align: center;">0.04127</td>
</tr>
<tr class="even">
<td style="text-align: center;">GLM (trad.)</td>
<td style="text-align: center;">0.17587</td>
<td style="text-align: center;">0.04538</td>
<td style="text-align: center;">-0.92157</td>
<td style="text-align: center;">-0.95984</td>
<td style="text-align: center;">-2.22852</td>
<td style="text-align: center;">0.04121</td>
</tr>
<tr class="odd">
<td style="text-align: center;">LASSO (optimal)</td>
<td style="text-align: center;">0.17169</td>
<td style="text-align: center;">0.04492</td>
<td style="text-align: center;">-0.92229</td>
<td style="text-align: center;">-0.96004</td>
<td style="text-align: center;">-2.34060</td>
<td style="text-align: center;">0.04081</td>
</tr>
<tr class="even">
<td style="text-align: center;">LASSO (parsimonious)</td>
<td style="text-align: center;">0.17332</td>
<td style="text-align: center;">0.04511</td>
<td style="text-align: center;">-0.92202</td>
<td style="text-align: center;">-0.95997</td>
<td style="text-align: center;">-2.28596</td>
<td style="text-align: center;">0.04097</td>
</tr>
<tr class="odd">
<td style="text-align: center;">XGBoost</td>
<td style="text-align: center;">0.14560</td>
<td style="text-align: center;">0.03648</td>
<td style="text-align: center;">-0.93145</td>
<td style="text-align: center;">-0.96369</td>
<td style="text-align: center;">-2.72777</td>
<td style="text-align: center;">0.03509</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<p>A challenge associated with the XGBoost approach is comprehending the full impact of each segmentation variable. The following graph depicts the most crucial variables in the XGBoost model. We observe that the credit score, the territory, the age of the insured, and the years without claim are the most significant covariates in the XGBoost model.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.08846194</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">43</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="fl">0.8389601</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_child_weight =</span> <span class="dv">1</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">booster =</span> <span class="st">"gbtree"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">"count:poisson"</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">eval_metric =</span> <span class="st">"poisson-nloglik"</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">333</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>fit.xgb <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(<span class="at">params =</span> param,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">nrounds =</span> <span class="dv">96</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> dtrain)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>importance_matrix <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="fu">dimnames</span>(dtrain)[[<span class="dv">2</span>]], <span class="at">model =</span> fit.xgb)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.ggplot.importance</span>(importance_matrix,<span class="at">top_n=</span><span class="dv">10</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">15</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="VarTraditionelles_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./DataSummary.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Summary</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./VarTelematiques.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Telematic Covariates</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>